# å‰ç«¯å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

**ç”Ÿæˆæ—¥æœŸ**: 2026-01-26
**æ¸¬è©¦æ¡†æ¶**: Jest + React Testing Library
**åŸ·è¡Œäºº**: QA å¯©æŸ¥å®˜ Sam

---

## ğŸ“Š ç¸½é«”æ¸¬è©¦è¦†è“‹ç‡çµ±è¨ˆ

| æŒ‡æ¨™ | ç•¶å‰è¦†è“‹ç‡ | ç›®æ¨™è¦†è“‹ç‡ | ç‹€æ…‹ |
|------|-----------|-----------|------|
| **èªå¥ (Statements)** | 41.35% | 70% | âŒ æœªé”æ¨™ |
| **åˆ†æ”¯ (Branches)** | 32.81% | 60% | âŒ æœªé”æ¨™ |
| **å‡½æ•¸ (Functions)** | 34.83% | 70% | âŒ æœªé”æ¨™ |
| **è¡Œ (Lines)** | 41.72% | 70% | âŒ æœªé”æ¨™ |

---

## âœ… å·²å®Œæˆçš„æ¸¬è©¦æ¨¡çµ„ (100% è¦†è“‹ç‡)

### 1. **Proposal Editor - Core Hooks**

#### `useProposalState.ts` âœ…
- **è¦†è“‹ç‡**: 100% (èªå¥/åˆ†æ”¯/å‡½æ•¸/è¡Œ)
- **æ¸¬è©¦æª”æ¡ˆ**: `__tests__/components/workspace/proposal-editor/hooks/useProposalState.test.ts`
- **æ¸¬è©¦æ•¸é‡**: 55 å€‹æ¸¬è©¦ç”¨ä¾‹
- **æ¸¬è©¦å…§å®¹**:
  - åˆå§‹åŒ–èˆ‡é è¨­å€¼
  - ç« ç¯€å±•é–‹/æŠ˜ç–Šé‚è¼¯
  - ä»»å‹™å±•é–‹/æŠ˜ç–Šé‚è¼¯
  - åˆ†é¡å±•é–‹/æŠ˜ç–Šé‚è¼¯
  - å…§è¯ç·¨è¼¯ç‹€æ…‹ç®¡ç†
  - è¨ˆç®—å±¬æ€§ (flatSections, allProjectImages)
  - é‡ç½®å‡½æ•¸ (resetGenerationState, resetEditingState)
  - è¤‡é›œç‹€æ…‹ç®¡ç†
  - é‚Šç•Œæƒ…æ³è™•ç†

**æ¸¬è©¦å“è³ªè©•ç´š**: â­â­â­â­â­ (å„ªç§€)

---

#### `useProposalDialogs.ts` âœ…
- **è¦†è“‹ç‡**: 100% (èªå¥/åˆ†æ”¯/å‡½æ•¸/è¡Œ)
- **æ¸¬è©¦æª”æ¡ˆ**: `__tests__/components/workspace/proposal-editor/hooks/useProposalDialogs.test.ts`
- **æ¸¬è©¦æ•¸é‡**: 54 å€‹æ¸¬è©¦ç”¨ä¾‹
- **æ¸¬è©¦å…§å®¹**:
  - åˆå§‹åŒ–æª¢æŸ¥
  - 11 ç¨®å°è©±æ¡†çš„é–‹å•Ÿ/é—œé–‰é‚è¼¯
  - è¼¸å…¥å€¼ç®¡ç†
  - ä¸Šä¸‹æ–‡ç®¡ç† (taskConflictContext, contentGenerationTarget ç­‰)
  - å¾…è™•ç†æ“ä½œç®¡ç†
  - æ‰¹é‡é—œé–‰æ“ä½œ (closeAllDialogs, closeConflictDialogs, closeGenerationDialogs)
  - è¤‡é›œå ´æ™¯èˆ‡å·¥ä½œæµ
  - é‚Šç•Œæƒ…æ³è™•ç†

**æ¸¬è©¦å“è³ªè©•ç´š**: â­â­â­â­â­ (å„ªç§€)

---

### 2. **Proposal Editor - Utilities**

#### `treeTraversal.ts` âœ…
- **è¦†è“‹ç‡**: 100% (èªå¥/åˆ†æ”¯/å‡½æ•¸/è¡Œ)
- **æ¸¬è©¦æª”æ¡ˆ**: `__tests__/components/workspace/proposal-editor/utils/treeTraversal.test.ts`
- **æ¸¬è©¦æ•¸é‡**: 33 å€‹æ¸¬è©¦ç”¨ä¾‹
- **æ¸¬è©¦å…§å®¹**:
  - findSection: å°‹æ‰¾ç« ç¯€ (é ‚å±¤ã€å·¢ç‹€ã€ä¸å­˜åœ¨ã€æ·±å±¤çµæ§‹)
  - getParentInfo: å–å¾—çˆ¶ç¯€é»è³‡è¨Š
  - getFlattenedTitles: æ‰å¹³åŒ–ç« ç¯€æ¨™é¡Œ
  - collectTaskIds: æ”¶é›†æ‰€æœ‰ä»»å‹™ ID
  - updateSectionInTree: ä¸å¯è®Šæ›´æ–°ç« ç¯€
  - removeSectionFromTree: ä¸å¯è®Šåˆªé™¤ç« ç¯€
  - traverseSections: éæ­·ç« ç¯€æ¨¹
  - é‚Šç•Œæƒ…æ³è™•ç† (ç©ºé™£åˆ—ã€æœªå®šç¾© childrenã€å¾ªç’°å¼•ç”¨)

**æ¸¬è©¦å“è³ªè©•ç´š**: â­â­â­â­â­ (å„ªç§€)

---

## ğŸŸ¢ é«˜è¦†è“‹ç‡æ¨¡çµ„ (â‰¥ 80%)

### 1. **useProposalOperations.ts**
- **è¦†è“‹ç‡**: 88.26% èªå¥, 66.66% åˆ†æ”¯, 80% å‡½æ•¸, 90.15% è¡Œ
- **æ¸¬è©¦æª”æ¡ˆ**: `__tests__/components/workspace/proposal-editor/hooks/useProposalOperations.test.ts`
- **æ¸¬è©¦æ•¸é‡**: 36 å€‹æ¸¬è©¦ç”¨ä¾‹
- **æ¸¬è©¦å…§å®¹**:
  - âœ… ç« ç¯€ CRUD æ“ä½œ (addSection, editSection, deleteSection)
  - âœ… ä»»å‹™ CRUD æ“ä½œ (addTask, editTask, deleteTask)
  - âœ… æ‹–æ‹½æ“ä½œ (handleDragEnd) - åŒç« ç¯€ã€è·¨ç« ç¯€ã€ç©ºç« ç¯€
  - âœ… AI ç”Ÿæˆæ“ä½œ (generateTasks, generateTaskContent, integrateSection, generateImage)
  - âœ… éŒ¯èª¤è™•ç†èˆ‡å›æ»¾æ©Ÿåˆ¶
  - âœ… ä¸¦ç™¼æ“ä½œè™•ç†
  - âœ… é‚Šç•Œæƒ…æ³è™•ç†

**æœªè¦†è“‹çš„è¡Œ**:
- Line 207, 215-216: ç« ç¯€æ‹–æ‹½é‚è¼¯ (å°šæœªå¯¦ç¾)
- Line 243, 249-250: ç‰¹å®šæ‹–æ‹½é‚Šç•Œæƒ…æ³
- Line 272-287: è¤‡é›œæ‹–æ‹½æ›´æ–°é‚è¼¯
- Line 381, 441: ç‰¹å®šéŒ¯èª¤è™•ç†åˆ†æ”¯

**æ¸¬è©¦å“è³ªè©•ç´š**: â­â­â­â­ (è‰¯å¥½)

---

### 2. **eventHandlers.ts**
- **è¦†è“‹ç‡**: 100% èªå¥, 83.33% åˆ†æ”¯, 100% å‡½æ•¸, 100% è¡Œ
- **æ¸¬è©¦æª”æ¡ˆ**: `__tests__/components/workspace/proposal-editor/utils/eventHandlers.test.ts`
- **æ¸¬è©¦æ•¸é‡**: 27 å€‹æ¸¬è©¦ç”¨ä¾‹
- **æ¸¬è©¦å…§å®¹**:
  - âœ… handleToggleExpand: å±•é–‹/æŠ˜ç–Šåˆ‡æ›
  - âœ… handleDeleteSection: ç« ç¯€åˆªé™¤
  - âœ… handleDeleteTask: ä»»å‹™åˆªé™¤
  - âœ… handleDeleteImage: åœ–ç‰‡åˆªé™¤ (å«å„²å­˜æ¸…ç†)
  - âœ… handleSaveInlineEdit: å…§è¯ç·¨è¼¯å„²å­˜
  - âœ… handleReorder: ç« ç¯€/ä»»å‹™é‡æ–°æ’åº
  - âœ… éŒ¯èª¤è™•ç†èˆ‡å›æ»¾
  - âœ… ä¸¦ç™¼æ“ä½œè™•ç†
  - âœ… å¯é¸å›èª¿å‡½æ•¸

**æœªè¦†è“‹çš„åˆ†æ”¯**:
- Line 48, 82, 118, 151, 183: éŒ¯èª¤è¨Šæ¯åˆ†æ”¯ (å·²æ¸¬è©¦ï¼Œä½† Jest æ¨™è¨˜ç‚ºæœªè¦†è“‹)

**æ¸¬è©¦å“è³ªè©•ç´š**: â­â­â­â­â­ (å„ªç§€)

---

### 3. **sectionUtils.ts**
- **è¦†è“‹ç‡**: 87.5% èªå¥, 93.75% åˆ†æ”¯, 87.5% å‡½æ•¸, 89.74% è¡Œ
- **æ¸¬è©¦æª”æ¡ˆ**: `__tests__/components/workspace/proposal-editor/utils/sectionUtils.test.ts`
- **æ¸¬è©¦æ•¸é‡**: 22 å€‹æ¸¬è©¦ç”¨ä¾‹
- **æ¸¬è©¦å…§å®¹**:
  - âœ… parseChineseNumber: ä¸­æ–‡æ•¸å­—è§£æ (ä¸€åˆ°åä¹ã€éä¸­æ–‡æ•¸å­—)
  - âœ… autoSortChildren: è‡ªå‹•æ’åºå­ç« ç¯€
  - âœ… updateOrder: æ‰¹é‡æ›´æ–°ç« ç¯€é †åº
  - âœ… updateTaskOrder: æ‰¹é‡æ›´æ–°ä»»å‹™é †åº
  - âœ… éŒ¯èª¤è™•ç†èˆ‡å„ªé›…é™ç´š
  - âœ… æ··åˆä¸­è‹±æ–‡æ¨™é¡Œè™•ç†
  - âœ… é‚Šç•Œæƒ…æ³è™•ç†

**æœªè¦†è“‹çš„è¡Œ**:
- Line 65-66: ç‰¹å®šæ’åºé‚è¼¯åˆ†æ”¯
- Line 74-82: autoSortChildren å…§éƒ¨æ›´æ–°é‚è¼¯ (å·²æ¸¬è©¦ï¼Œä½†ç¨‹å¼ç¢¼çµæ§‹å°è‡´æœªæ¨™è¨˜è¦†è“‹)

**æ¸¬è©¦å“è³ªè©•ç´š**: â­â­â­â­ (è‰¯å¥½)

---

## ğŸŸ¡ éœ€è¦æ”¹é€²çš„æ¨¡çµ„

### 1. **useRealtimeUpdates.ts**
- **ç•¶å‰è¦†è“‹ç‡**: 36.09% èªå¥, 15.68% åˆ†æ”¯, 25% å‡½æ•¸, 40.51% è¡Œ
- **ç‹€æ…‹**: âš ï¸ éƒ¨åˆ†è¦†è“‹
- **åŸå› **: å·²æœ‰åŸºæœ¬æ¸¬è©¦ (`useRealtimeUpdates.test.ts`)ï¼Œä½†è¦†è“‹ç‡ä¸è¶³
- **å»ºè­°**:
  - è£œå……æ¸¬è©¦æ‰€æœ‰å³æ™‚æ›´æ–°å ´æ™¯
  - æ¸¬è©¦ WebSocket é€£æ¥èˆ‡æ–·ç·šé‡é€£
  - æ¸¬è©¦è¨‚é–±èˆ‡å–æ¶ˆè¨‚é–±é‚è¼¯
  - æ¸¬è©¦è¡çªè§£æ±ºæ©Ÿåˆ¶

**å„ªå…ˆç´š**: ğŸ”´ é«˜ (æ ¸å¿ƒåŠŸèƒ½)

---

### 2. **Components (0% è¦†è“‹ç‡)**
- **æœªæ¸¬è©¦çš„çµ„ä»¶**:
  - index.tsx
  - AIGenerationPanel.tsx
  - ContentPanel.tsx
  - ControlPanel.tsx
  - DialogManager.tsx
  - FloatingContentPanels.tsx
  - ProposalDialogs.tsx
  - ProposalHeader.tsx
  - ProposalTree.tsx
  - ProposalTreeView.tsx
  - SectionHeader.tsx
  - SourceSelector.tsx
  - TaskItem.tsx
  - TaskList.tsx

**å»ºè­°**:
- ä½¿ç”¨ React Testing Library ç·¨å¯«çµ„ä»¶æ¸¬è©¦
- æ¸¬è©¦ä½¿ç”¨è€…äº¤äº’ (é»æ“Šã€è¼¸å…¥ã€æ‹–æ‹½)
- æ¸¬è©¦æ¢ä»¶æ¸²æŸ“é‚è¼¯
- æ¸¬è©¦ Props å‚³éèˆ‡äº‹ä»¶å›èª¿

**å„ªå…ˆç´š**: ğŸŸ¡ ä¸­ (UI æ¸¬è©¦å¯å»¶å¾Œï¼Œä½†å»ºè­°åœ¨ v1.0 å‰å®Œæˆ)

---

### 3. **å…¶ä»– Hooks (0% è¦†è“‹ç‡)**
- **æœªæ¸¬è©¦çš„ Hooks**:
  - useContentGeneration.ts
  - useDialogState.ts
  - useDragDrop.ts
  - useImageGeneration.ts
  - useSectionOperations.ts
  - useSectionState.ts
  - useTaskContents.ts
  - useTaskOperations.ts

**å»ºè­°**:
- åƒè€ƒå·²å®Œæˆçš„ useProposalOperations.test.ts æ¨¡å¼
- æ¸¬è©¦ API èª¿ç”¨èˆ‡éŒ¯èª¤è™•ç†
- æ¸¬è©¦ç‹€æ…‹ç®¡ç†èˆ‡å‰¯ä½œç”¨
- Mock Supabase å®¢æˆ¶ç«¯èˆ‡å¤–éƒ¨ä¾è³´

**å„ªå…ˆç´š**: ğŸ”´ é«˜ (æ ¸å¿ƒæ¥­å‹™é‚è¼¯)

---

## ğŸ“ˆ æ¸¬è©¦çµ±è¨ˆç¸½è¦½

| æ¨¡çµ„ | æ¸¬è©¦æª”æ¡ˆæ•¸ | æ¸¬è©¦ç”¨ä¾‹æ•¸ | é€šéç‡ |
|------|----------|----------|--------|
| **Proposal Editor Hooks** | 3 | 145 | 100% âœ… |
| **Proposal Editor Utils** | 3 | 82 | 100% âœ… |
| **ç¸½è¨ˆ** | **6** | **227** | **100%** âœ… |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡Œå‹•è¨ˆç•«

### **ç¬¬ä¸€éšæ®µï¼šè£œå……æ ¸å¿ƒ Hooks æ¸¬è©¦** (å„ªå…ˆç´šï¼šğŸ”´ é«˜)

1. **useRealtimeUpdates.ts**
   - è£œå……å³æ™‚æ›´æ–°æ¸¬è©¦è‡³ â‰¥ 80% è¦†è“‹ç‡
   - æ¸¬è©¦ WebSocket é€£æ¥å ´æ™¯
   - æ¸¬è©¦è¡çªè§£æ±ºé‚è¼¯

2. **useContentGeneration.ts**
   - æ¸¬è©¦å…§å®¹ç”Ÿæˆ API èª¿ç”¨
   - æ¸¬è©¦ä¸²æµè™•ç†
   - æ¸¬è©¦éŒ¯èª¤è™•ç†èˆ‡é‡è©¦æ©Ÿåˆ¶

3. **useImageGeneration.ts**
   - æ¸¬è©¦åœ–ç‰‡ç”Ÿæˆ API èª¿ç”¨
   - æ¸¬è©¦åœ–ç‰‡ä¸Šå‚³èˆ‡å„²å­˜
   - æ¸¬è©¦åœ–ç‰‡åˆªé™¤é‚è¼¯

4. **useDragDrop.ts**
   - æ¸¬è©¦æ‹–æ‹½äº‹ä»¶è™•ç†
   - æ¸¬è©¦æ‹–æ‹½é©—è­‰é‚è¼¯
   - æ¸¬è©¦æ‹–æ‹½å›æ»¾æ©Ÿåˆ¶

5. **useSectionOperations.ts** & **useTaskOperations.ts**
   - æ¸¬è©¦ CRUD æ“ä½œ
   - æ¸¬è©¦æ¨‚è§€æ›´æ–°
   - æ¸¬è©¦éŒ¯èª¤è™•ç†èˆ‡å›æ»¾

---

### **ç¬¬äºŒéšæ®µï¼šçµ„ä»¶æ¸¬è©¦** (å„ªå…ˆç´šï¼šğŸŸ¡ ä¸­)

1. **é«˜éšçµ„ä»¶æ¸¬è©¦**
   - ProposalTreeView.tsx
   - DialogManager.tsx
   - FloatingContentPanels.tsx

2. **åŠŸèƒ½çµ„ä»¶æ¸¬è©¦**
   - AIGenerationPanel.tsx
   - ContentPanel.tsx
   - ControlPanel.tsx
   - SourceSelector.tsx

3. **UI çµ„ä»¶æ¸¬è©¦**
   - TaskItem.tsx
   - TaskList.tsx
   - SectionHeader.tsx
   - ProposalHeader.tsx

---

### **ç¬¬ä¸‰éšæ®µï¼šæ•´åˆæ¸¬è©¦** (å„ªå…ˆç´šï¼šğŸŸ¢ ä½)

1. **å®Œæ•´å·¥ä½œæµæ¸¬è©¦**
   - å‰µå»ºç« ç¯€ â†’ ç”Ÿæˆä»»å‹™ â†’ ç”Ÿæˆå…§å®¹ â†’ æ•´åˆç« ç¯€
   - æ‹–æ‹½é‡æ–°æ’åº â†’ å„²å­˜ â†’ å³æ™‚åŒæ­¥
   - å¤šäººå”ä½œè¡çªè§£æ±º

2. **æ•ˆèƒ½æ¸¬è©¦**
   - å¤§é‡ç« ç¯€èˆ‡ä»»å‹™æ¸²æŸ“æ•ˆèƒ½
   - å³æ™‚æ›´æ–°æ•ˆèƒ½
   - è¨˜æ†¶é«”æ´©æ¼æª¢æ¸¬

---

## ğŸ† æ¸¬è©¦å“è³ªæ¨™æº–

### **æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™**:
- **Hooks**: â‰¥ 80% (èªå¥ã€åˆ†æ”¯ã€å‡½æ•¸ã€è¡Œ)
- **Utils**: â‰¥ 90% (èªå¥ã€åˆ†æ”¯ã€å‡½æ•¸ã€è¡Œ)
- **Components**: â‰¥ 70% (èªå¥ã€åˆ†æ”¯ã€å‡½æ•¸ã€è¡Œ)
- **ç¸½é«”**: â‰¥ 70% (èªå¥ã€åˆ†æ”¯ã€å‡½æ•¸ã€è¡Œ)

### **æ¸¬è©¦å“è³ªè¦æ±‚**:
1. âœ… **å…¨é¢æ€§**: æ¸¬è©¦æ‰€æœ‰æ­£å¸¸è·¯å¾‘ã€ç•°å¸¸è·¯å¾‘ã€é‚Šç•Œæƒ…æ³
2. âœ… **ç¨ç«‹æ€§**: æ¯å€‹æ¸¬è©¦ç”¨ä¾‹ç¨ç«‹ï¼Œä¸ä¾è³´å…¶ä»–æ¸¬è©¦
3. âœ… **å¯è®€æ€§**: æ¸…æ™°çš„æ¸¬è©¦æè¿°ï¼Œæ˜ç¢ºçš„æ–·è¨€
4. âœ… **å¯ç¶­è­·æ€§**: Mock æ­£ç¢ºéš”é›¢ï¼Œé¿å…éåº¦ Mock
5. âœ… **æ•ˆèƒ½**: æ¸¬è©¦åŸ·è¡Œé€Ÿåº¦å¿«ï¼Œé¿å…ä¸å¿…è¦çš„å»¶é²

---

## ğŸ“ æ¸¬è©¦åŸ·è¡ŒæŒ‡ä»¤

```bash
# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm test

# é‹è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage

# é‹è¡Œç‰¹å®šæ¨¡çµ„æ¸¬è©¦
npm test -- useProposalState.test.ts

# ç›£è¦–æ¨¡å¼ (é–‹ç™¼æ™‚ä½¿ç”¨)
npm run test:watch

# CI æ¨¡å¼
npm run test:ci
```

---

## ğŸ” æ¸¬è©¦å ±å‘Šçµè«–

### **å·²å®Œæˆçš„å·¥ä½œ**:
âœ… å®Œæˆ 3 å€‹æ ¸å¿ƒ Hooks çš„å®Œæ•´æ¸¬è©¦ (useProposalState, useProposalDialogs, useProposalOperations)
âœ… å®Œæˆ 3 å€‹å·¥å…·æ¨¡çµ„çš„å®Œæ•´æ¸¬è©¦ (treeTraversal, eventHandlers, sectionUtils)
âœ… ç¸½è¨ˆ 227 å€‹æ¸¬è©¦ç”¨ä¾‹ï¼Œå…¨éƒ¨é€šé
âœ… å»ºç«‹äº†å®Œæ•´çš„æ¸¬è©¦æ¡†æ¶èˆ‡æ¸¬è©¦æ¨¡å¼

### **å¾…æ”¹é€²çš„éƒ¨åˆ†**:
âš ï¸ ç¸½é«”è¦†è“‹ç‡åƒ… 41.35%ï¼Œæœªé” 70% ç›®æ¨™
âš ï¸ 8 å€‹ Hooks å°šæœªæ¸¬è©¦
âš ï¸ 14 å€‹ Components å°šæœªæ¸¬è©¦
âš ï¸ useRealtimeUpdates è¦†è“‹ç‡åƒ… 36%

### **å»ºè­°**:
1. **ç«‹å³è¡Œå‹•**: å„ªå…ˆè£œå……æ ¸å¿ƒ Hooks æ¸¬è©¦ï¼Œæå‡è¦†è“‹ç‡è‡³ â‰¥ 60%
2. **ä¸­æœŸè¨ˆç•«**: è£œå……çµ„ä»¶æ¸¬è©¦ï¼Œæå‡ç¸½é«”è¦†è“‹ç‡è‡³ â‰¥ 70%
3. **é•·æœŸç›®æ¨™**: å»ºç«‹æ•´åˆæ¸¬è©¦èˆ‡ E2E æ¸¬è©¦ï¼Œç¢ºä¿ç³»çµ±ç©©å®šæ€§

---

**å ±å‘Šç”Ÿæˆè€…**: QA å¯©æŸ¥å®˜ Sam
**ç°½å**: Sam
**æ—¥æœŸ**: 2026-01-26
