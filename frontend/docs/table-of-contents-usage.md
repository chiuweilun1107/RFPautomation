# Table of Contents 使用指南

## 功能位置
在 **SOURCE DETAILS** 側邊欄中，當查看完整的文檔內容時（非 citation 視圖），會自動顯示章節導航。

## 視覺結構

```
┌─────────────────────────────────────────┐
│ SOURCE DETAILS                    [X]   │ ← Header
├─────────────────────────────────────────┤
│ TABLE OF CONTENTS (8)              [▼]  │ ← 可折疊標題
├─────────────────────────────────────────┤
│   計畫概述                    p.1       │
│   緣起                        p.1       │
│   計畫名稱                    p.1       │ ← 章節列表
│   計畫目標                    p.2       │   (可滾動)
│   執行策略                    p.3       │
│   預期效益                    p.5       │
│   ···                                   │
├─────────────────────────────────────────┤
│                                         │
│  FULL CONTENT                           │
│  ─────────────────────────────          │
│                                         │ ← 文檔內容
│  ## 計畫概述                            │   (可滾動)
│  本計畫旨在...                          │
│  ...                                    │
│                                         │
└─────────────────────────────────────────┘
```

## 使用流程

### 1. 查看文檔
- 在 SOURCE MANAGER 中點擊任何文檔
- 側邊欄自動打開 SOURCE DETAILS

### 2. 查看目錄
- 如果文檔有章節結構，會自動顯示 "TABLE OF CONTENTS"
- 默認展開，顯示所有章節
- 括號中顯示章節總數，例如 `(8)`

### 3. 折疊/展開
- 點擊 "TABLE OF CONTENTS (8)" 標題欄
- 圖標變化：`▼` (展開) ↔ `▶` (折疊)
- 節省空間，專注閱讀

### 4. 點擊跳轉
- 點擊任意章節項目
- 文檔內容自動**平滑滾動**到對應位置
- 章節項目高亮顯示（黑底白字 + 加粗）

## 交互效果

### 懸停效果
```
正常狀態：
┌────────────────────────┐
│ 計畫概述          p.1  │  ← 灰色文字
└────────────────────────┘

懸停狀態：
┌────────────────────────┐
│ █ 計畫概述      p.1 █  │  ← 黑底白字
└────────────────────────┘
```

### 活躍狀態
```
點擊後：
┌────────────────────────┐
│ █ 計畫概述      p.1 █  │  ← 黑底白字 + 加粗
└────────────────────────┘
```

### 多層級顯示
```
┌──────────────────────────┐
│ 第一章 總論         p.1  │  ← 第 1 級（最左）
│   1.1 背景         p.2   │  ← 第 2 級（縮進 12px）
│     1.1.1 起源    p.3    │  ← 第 3 級（縮進 24px）
└──────────────────────────┘
```

## 自動檢測機制

### 會顯示目錄的情況
✅ 文檔包含明確的目錄區段（例如 "目　　錄"）
✅ 文檔包含 Markdown 標題（`##`, `###`）
✅ 至少有 1 個章節項目

### 不會顯示目錄的情況
❌ 查看 Citation 詳情（只顯示引用片段）
❌ 文檔無章節結構（純文字）
❌ 文檔內容為空

## 支持的目錄格式

### 格式 1：目錄格式
```markdown
## 目　　錄
頁碼
[壹、　　計畫概述　1](.)
[一、　　緣起　1](.)
[二、　　計畫名稱　1](.)
[三、　　計畫目標　2](.)
```

解析結果：
- 標題：計畫概述、緣起、計畫名稱、計畫目標
- 頁碼：1, 1, 1, 2
- 自動清理編號（壹、一、二、三）

### 格式 2：Markdown 標題
```markdown
## 第一章 計畫概述

### 1.1 緣起

### 1.2 目標

## 第二章 執行策略
```

解析結果：
- 第 1 級：第一章 計畫概述、第二章 執行策略
- 第 2 級：1.1 緣起、1.2 目標

## 鍵盤操作

### 當前支持
- **Tab**: 聚焦到下一個章節項目
- **Enter/Space**: 跳轉到選中的章節
- **Escape**: 關閉側邊欄（原有功能）

### 未來增強
- 方向鍵（↑↓）: 在章節間移動
- Home/End: 跳到第一個/最後一個章節

## 性能特性

### 優化措施
1. **useMemo 緩存**
   - 只在 content 變化時重新解析
   - 避免不必要的計算

2. **最大高度限制**
   - 目錄最高 240px
   - 超出部分可滾動
   - 不影響主要內容區域

3. **平滑滾動**
   - CSS `scroll-behavior: smooth`
   - 提供視覺連貫性
   - 不阻塞 UI 線程

## 已知限制

### 滾動定位精度
- 使用字符估算（約 0.15px/字符）
- 實際位置受字體、行高影響
- **典型誤差**：± 50-100px

### 改進方案（未來）
- 使用 DOM 測量
- 為章節添加錨點元素
- 使用 `scrollIntoView` API

## 常見問題

### Q: 為什麼我看不到目錄？
A: 檢查以下條件：
1. 確保不是在 Citation 視圖
2. 確保文檔有章節結構
3. 確保文檔已完整加載

### Q: 點擊後滾動不準確？
A: 這是已知限制。目前使用字符估算，未來會改進為 DOM 測量。

### Q: 可以搜索章節嗎？
A: 目前不支持，但已列入未來改進計劃。

### Q: 支持多少級標題？
A: 目前支持 1-3 級標題。超過 3 級的標題會被忽略。

### Q: 目錄可以固定顯示嗎？
A: 目前目錄會跟隨側邊欄滾動。未來可能添加「固定目錄」選項。

## 設計理念

### Swiss/Brutalist 風格
- **極簡主義**: 只顯示必要信息
- **功能優先**: 快速導航是核心目標
- **高對比**: 黑白配色，清晰易讀
- **方正字體**: Monospace 字體，強調結構

### 用戶體驗原則
1. **自動化**: 無需手動開啟，自動檢測
2. **非侵入**: 可折疊，不干擾閱讀
3. **即時反饋**: 懸停、點擊都有視覺響應
4. **直觀操作**: 點擊即跳轉，無需學習

## 版本歷史

### v1.0 (Current)
- ✅ 基礎章節解析
- ✅ 點擊跳轉
- ✅ 折疊/展開
- ✅ 活躍狀態高亮
- ✅ 多層級支持

### 計劃中 (Future)
- ⏳ 當前位置自動高亮（Intersection Observer）
- ⏳ 章節搜索
- ⏳ 鍵盤完整支持
- ⏳ 更精確的滾動定位
- ⏳ 子章節展開/折疊
