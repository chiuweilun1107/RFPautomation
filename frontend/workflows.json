{"data":[{"updatedAt":"2026-01-08T11:13:25.320Z","createdAt":"2026-01-08T09:24:37.422Z","id":"3_DZvjSYb3fCgqMC3WlRP","name":"My workflow (Final Cloud IP Fix)","active":true,"isArchived":false,"nodes":[{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[2816,368],"id":"d014a5c2-9c7b-4e47-8b0d-1bd52c41bc1b","name":"Azure OpenAI Chat Model","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[2976,544],"id":"30c5b258-4d16-41c6-b302-da3bc04ab18e","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolWikipedia","typeVersion":1,"position":[3136,544],"id":"e4363b1d-e73e-483d-b085-f719a6e21dcd","name":"Wikipedia"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[3248,544],"id":"c9cba9dd-4231-48cf-a3fc-408d8313d761","name":"Calculator"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"6fe4047c8888d1c9109d10a0601e1bbe17e1e89c"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.3,"position":[3344,544],"id":"d576b9bb-1f65-4708-8473-23ef99ef92d0","name":"serper search"},{"parameters":{"options":{"systemMessage":"=ç¾åœ¨çš„æ™‚é–“æ˜¯ï¼š{{ $now.format('yyyy-MM-dd HH:mm:ss') }}\n- è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n- é‡åˆ°çŸ¥è­˜åº«å’Œè³‡æ–™åº«ç›¸é—œå•é¡Œè«‹é€é Rag agent","maxIterations":10,"returnIntermediateSteps":true,"enableStreaming":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[3072,144],"id":"662cea1e-2af6-4bd0-b68e-b01b1ba74278","name":"Orchestrator"},{"parameters":{"descriptionType":"manual","toolDescription":"ã€Œæ­¤å·¥å…·å¯ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµæ§‹èˆ‡å…§å®¹ã€‚ç•¶ä½¿ç”¨è€…è©¢å•è³‡æ–™è¡¨æ•¸é‡ã€åç¨±æˆ– schema è³‡è¨Šæ™‚ï¼Œè«‹ä½¿ç”¨æ­¤å·¥å…·åŸ·è¡Œ SQL æŸ¥è©¢ã€‚ã€","operation":"executeQuery","query":"SELECT count(*) AS table_count \nFROM information_schema.tables \nWHERE table_schema = 'public';","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[3664,512],"id":"ca843021-fb6c-4a2c-a94a-b519c2763d45","name":"Execute a SQL query in Postgres","credentials":{"postgres":{"id":"Bykxx4QHz6cqTLe8","name":"Postgres account"}}},{"parameters":{"name":"rag_search","description":"ä¸»è¦æœå°‹å·¥å…·ã€‚ç•¶ä½¿ç”¨è€…è©¢å•å…¬å¸æ–‡ä»¶ã€SOPã€æ¨™æ¡ˆè¦ç¯„ã€å‰¯ç¸½æŒ‡ç¤ºç­‰å…§å®¹æ™‚ï¼Œå¿…é ˆå„ªå…ˆä½¿ç”¨æ­¤å·¥å…·ã€‚è¼¸å…¥ç‚ºä½¿ç”¨è€…çš„æŸ¥è©¢å•é¡Œ(query)ã€‚","jsCode":"// Fixed variable shadowing AND URL\nconst userQuery = query;\n\n// Using user's cloud IP explicitly\nconst webhookUrl = 'http://159.223.50.159:5678/webhook/rag-search';\n\ntry {\n  const response = await this.helpers.request({\n    method: 'POST',\n    uri: webhookUrl,\n    body: {\n      query: userQuery\n    },\n    json: true\n  });\n\n  // Handle both possible response formats\n  if (response.response) {\n    return response.response;\n  }\n  return JSON.stringify(response);\n\n} catch (error) {\n  return \"Search failed: \" + error.message;\n}"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1,"position":[3792,512],"id":"ca51d1cb-8b85-479e-b7f0-e7f8ad104262","name":"RAG Search Tool (Custom)"},{"parameters":{"text":"=<agent_identity>\nä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ¨™æ¡ˆæ’°å¯«å°ˆå®¶èˆ‡è³‡æ–™æŸ¥è©¢åŠ©ç†ï¼Œå°ˆé–€å”åŠ©ä½¿ç”¨è€…æŸ¥è©¢è³‡æ–™åº«å’ŒçŸ¥è­˜åº«å…§éƒ¨ç›¸é—œè³‡è¨Šä¸¦ç”¢å‡ºå°ˆæ¥­å ±å‘Šã€‚\n</agent_identity>\n\n<core_mission>\nå”åŠ©ä½¿ç”¨è€…æŸ¥è©¢çŸ¥è­˜åº«è‚‹éƒ¨çš„æ¨™æ¡ˆSOPã€éå¾€æ¡ˆä¾‹ï¼Œä¸¦å°‡è³‡è¨Šæ•´ç†æˆå°ˆæ¥­çš„å ±å‘Šæ®µè½ã€‚\n</core_mission>\n\n<available_tools>\n<tool name=\"rag_search\" priority=\"highest\">\næ ¸å¿ƒå·¥å…·ã€‚ç•¶å•é¡Œæ¶‰åŠã€Œæ¨™æ¡ˆã€ã€ã€Œå°ˆæ¡ˆã€ã€ã€Œè¦ç« ã€ã€ã€ŒSOPã€ã€ã€Œå…§éƒ¨è¦å®šã€æ™‚ï¼Œå‹™å¿…å„ªå…ˆä½¿ç”¨ã€‚\n</tool>\n\n<tool name=\"postgres_sql\" priority=\"secondary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµ±è¨ˆæ•¸æ“šã€‚\n</tool>\n\n<tool name=\"wikipedia_serper\" priority=\"tertiary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢å¤–éƒ¨é€šç”¨çŸ¥è­˜ã€‚\n</tool>\n</available_tools>\n\n<strict_rules>\n<rule id=\"1\" name=\"å¿…é ˆæŸ¥è­‰\">\næœªç¶“ rag_search æŸ¥è­‰ï¼Œçµ•ä¸å¯æé€ å…¬å¸å…§éƒ¨è¦å®šã€‚è‹¥æŸ¥ç„¡çµæœï¼Œè«‹èª å¯¦å›è¦†ã€Œè³‡æ–™åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€ã€‚\n</rule>\n\n<rule id=\"2\" name=\"å·¥å…·å„ªå…ˆé †åº\">\næ¶‰åŠå…§éƒ¨è³‡è¨Š â†’ å…ˆç”¨ rag_search\næ¶‰åŠçµ±è¨ˆæ•¸æ“š â†’ ç”¨ postgres_sql\næ¶‰åŠå¤–éƒ¨çŸ¥è­˜ â†’ ç”¨ wikipedia/serper\n</rule>\n\n<rule id=\"3\" name=\"èªè¨€è¦ç¯„\">\nä¸€å¾‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n</rule>\n</strict_rules>\n\n<output_format>\nå›ç­”æ™‚å‹™å¿…ä¾ç…§ä»¥ä¸‹çµæ§‹ï¼š\n\n## ğŸ¯ æ ¸å¿ƒé‡é»\nç”¨åˆ—é»å¼æ‘˜è¦æŸ¥åˆ°çš„é—œéµäº‹å¯¦ã€‚\n\n## ğŸ’¡ å»¶ä¼¸è£œå……\né‡å°æ¨™æ¡ˆæ’°å¯«çš„å°ˆæ¥­å»ºè­°æˆ–æ³¨æ„äº‹é …ã€‚\n</output_format>\n\n<error_handling>\n- æŸ¥ç„¡è³‡æ–™æ™‚ï¼šæ˜ç¢ºå‘ŠçŸ¥ã€ŒçŸ¥è­˜åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€\n- è³‡è¨Šä¸å®Œæ•´æ™‚ï¼šèªªæ˜å·²æ‰¾åˆ°çš„éƒ¨åˆ†ï¼Œä¸¦å»ºè­°é€²ä¸€æ­¥æŸ¥è©¢æ–¹å‘\n- ä¸ç¢ºå®šæ™‚ï¼šä¸çŒœæ¸¬ï¼Œç›´æ¥è©¢å•ä½¿ç”¨è€…ä»¥é‡æ¸…éœ€æ±‚\n</error_handling>","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[3568,320],"id":"89696b2d-b4da-4ef0-b4af-2009348b97f5","name":"AI Agent Tool"},{"parameters":{"public":true,"availableInChat":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[2624,208],"id":"a363a592-7d1d-4c3c-b3a5-108024d4e188","name":"When chat message received","webhookId":"44862d51-5423-47c1-acee-7d90be483cab"}],"connections":{"Azure OpenAI Chat Model":{"ai_languageModel":[[{"node":"Orchestrator","type":"ai_languageModel","index":0},{"node":"AI Agent Tool","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orchestrator","type":"ai_memory","index":0},{"node":"AI Agent Tool","type":"ai_memory","index":0}]]},"Wikipedia":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"serper search":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Execute a SQL query in Postgres":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"RAG Search Tool (Custom)":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"Orchestrator":{"main":[[]]},"AI Agent Tool":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Orchestrator","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"fdd684ef-02b4-457b-a8f9-1dcb388bc7dc","activeVersionId":"fdd684ef-02b4-457b-a8f9-1dcb388bc7dc","triggerCount":1,"shared":[{"updatedAt":"2026-01-08T09:24:37.427Z","createdAt":"2026-01-08T09:24:37.427Z","role":"workflow:owner","workflowId":"3_DZvjSYb3fCgqMC3WlRP","projectId":"s582lXybVche97ry"}],"activeVersion":{"updatedAt":"2026-01-08T11:13:26.000Z","createdAt":"2026-01-08T11:13:25.322Z","versionId":"fdd684ef-02b4-457b-a8f9-1dcb388bc7dc","workflowId":"3_DZvjSYb3fCgqMC3WlRP","nodes":[{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[2816,368],"id":"d014a5c2-9c7b-4e47-8b0d-1bd52c41bc1b","name":"Azure OpenAI Chat Model","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[2976,544],"id":"30c5b258-4d16-41c6-b302-da3bc04ab18e","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolWikipedia","typeVersion":1,"position":[3136,544],"id":"e4363b1d-e73e-483d-b085-f719a6e21dcd","name":"Wikipedia"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[3248,544],"id":"c9cba9dd-4231-48cf-a3fc-408d8313d761","name":"Calculator"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"6fe4047c8888d1c9109d10a0601e1bbe17e1e89c"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.3,"position":[3344,544],"id":"d576b9bb-1f65-4708-8473-23ef99ef92d0","name":"serper search"},{"parameters":{"options":{"systemMessage":"=ç¾åœ¨çš„æ™‚é–“æ˜¯ï¼š{{ $now.format('yyyy-MM-dd HH:mm:ss') }}\n- è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n- é‡åˆ°çŸ¥è­˜åº«å’Œè³‡æ–™åº«ç›¸é—œå•é¡Œè«‹é€é Rag agent","maxIterations":10,"returnIntermediateSteps":true,"enableStreaming":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[3072,144],"id":"662cea1e-2af6-4bd0-b68e-b01b1ba74278","name":"Orchestrator"},{"parameters":{"descriptionType":"manual","toolDescription":"ã€Œæ­¤å·¥å…·å¯ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµæ§‹èˆ‡å…§å®¹ã€‚ç•¶ä½¿ç”¨è€…è©¢å•è³‡æ–™è¡¨æ•¸é‡ã€åç¨±æˆ– schema è³‡è¨Šæ™‚ï¼Œè«‹ä½¿ç”¨æ­¤å·¥å…·åŸ·è¡Œ SQL æŸ¥è©¢ã€‚ã€","operation":"executeQuery","query":"SELECT count(*) AS table_count \nFROM information_schema.tables \nWHERE table_schema = 'public';","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[3664,512],"id":"ca843021-fb6c-4a2c-a94a-b519c2763d45","name":"Execute a SQL query in Postgres","credentials":{"postgres":{"id":"Bykxx4QHz6cqTLe8","name":"Postgres account"}}},{"parameters":{"name":"rag_search","description":"ä¸»è¦æœå°‹å·¥å…·ã€‚ç•¶ä½¿ç”¨è€…è©¢å•å…¬å¸æ–‡ä»¶ã€SOPã€æ¨™æ¡ˆè¦ç¯„ã€å‰¯ç¸½æŒ‡ç¤ºç­‰å…§å®¹æ™‚ï¼Œå¿…é ˆå„ªå…ˆä½¿ç”¨æ­¤å·¥å…·ã€‚è¼¸å…¥ç‚ºä½¿ç”¨è€…çš„æŸ¥è©¢å•é¡Œ(query)ã€‚","jsCode":"// Fixed variable shadowing AND URL\nconst userQuery = query;\n\n// Using user's cloud IP explicitly\nconst webhookUrl = 'http://159.223.50.159:5678/webhook/rag-search';\n\ntry {\n  const response = await this.helpers.request({\n    method: 'POST',\n    uri: webhookUrl,\n    body: {\n      query: userQuery\n    },\n    json: true\n  });\n\n  // Handle both possible response formats\n  if (response.response) {\n    return response.response;\n  }\n  return JSON.stringify(response);\n\n} catch (error) {\n  return \"Search failed: \" + error.message;\n}"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1,"position":[3792,512],"id":"ca51d1cb-8b85-479e-b7f0-e7f8ad104262","name":"RAG Search Tool (Custom)"},{"parameters":{"text":"=<agent_identity>\nä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ¨™æ¡ˆæ’°å¯«å°ˆå®¶èˆ‡è³‡æ–™æŸ¥è©¢åŠ©ç†ï¼Œå°ˆé–€å”åŠ©ä½¿ç”¨è€…æŸ¥è©¢è³‡æ–™åº«å’ŒçŸ¥è­˜åº«å…§éƒ¨ç›¸é—œè³‡è¨Šä¸¦ç”¢å‡ºå°ˆæ¥­å ±å‘Šã€‚\n</agent_identity>\n\n<core_mission>\nå”åŠ©ä½¿ç”¨è€…æŸ¥è©¢çŸ¥è­˜åº«è‚‹éƒ¨çš„æ¨™æ¡ˆSOPã€éå¾€æ¡ˆä¾‹ï¼Œä¸¦å°‡è³‡è¨Šæ•´ç†æˆå°ˆæ¥­çš„å ±å‘Šæ®µè½ã€‚\n</core_mission>\n\n<available_tools>\n<tool name=\"rag_search\" priority=\"highest\">\næ ¸å¿ƒå·¥å…·ã€‚ç•¶å•é¡Œæ¶‰åŠã€Œæ¨™æ¡ˆã€ã€ã€Œå°ˆæ¡ˆã€ã€ã€Œè¦ç« ã€ã€ã€ŒSOPã€ã€ã€Œå…§éƒ¨è¦å®šã€æ™‚ï¼Œå‹™å¿…å„ªå…ˆä½¿ç”¨ã€‚\n</tool>\n\n<tool name=\"postgres_sql\" priority=\"secondary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµ±è¨ˆæ•¸æ“šã€‚\n</tool>\n\n<tool name=\"wikipedia_serper\" priority=\"tertiary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢å¤–éƒ¨é€šç”¨çŸ¥è­˜ã€‚\n</tool>\n</available_tools>\n\n<strict_rules>\n<rule id=\"1\" name=\"å¿…é ˆæŸ¥è­‰\">\næœªç¶“ rag_search æŸ¥è­‰ï¼Œçµ•ä¸å¯æé€ å…¬å¸å…§éƒ¨è¦å®šã€‚è‹¥æŸ¥ç„¡çµæœï¼Œè«‹èª å¯¦å›è¦†ã€Œè³‡æ–™åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€ã€‚\n</rule>\n\n<rule id=\"2\" name=\"å·¥å…·å„ªå…ˆé †åº\">\næ¶‰åŠå…§éƒ¨è³‡è¨Š â†’ å…ˆç”¨ rag_search\næ¶‰åŠçµ±è¨ˆæ•¸æ“š â†’ ç”¨ postgres_sql\næ¶‰åŠå¤–éƒ¨çŸ¥è­˜ â†’ ç”¨ wikipedia/serper\n</rule>\n\n<rule id=\"3\" name=\"èªè¨€è¦ç¯„\">\nä¸€å¾‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n</rule>\n</strict_rules>\n\n<output_format>\nå›ç­”æ™‚å‹™å¿…ä¾ç…§ä»¥ä¸‹çµæ§‹ï¼š\n\n## ğŸ¯ æ ¸å¿ƒé‡é»\nç”¨åˆ—é»å¼æ‘˜è¦æŸ¥åˆ°çš„é—œéµäº‹å¯¦ã€‚\n\n## ğŸ’¡ å»¶ä¼¸è£œå……\né‡å°æ¨™æ¡ˆæ’°å¯«çš„å°ˆæ¥­å»ºè­°æˆ–æ³¨æ„äº‹é …ã€‚\n</output_format>\n\n<error_handling>\n- æŸ¥ç„¡è³‡æ–™æ™‚ï¼šæ˜ç¢ºå‘ŠçŸ¥ã€ŒçŸ¥è­˜åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€\n- è³‡è¨Šä¸å®Œæ•´æ™‚ï¼šèªªæ˜å·²æ‰¾åˆ°çš„éƒ¨åˆ†ï¼Œä¸¦å»ºè­°é€²ä¸€æ­¥æŸ¥è©¢æ–¹å‘\n- ä¸ç¢ºå®šæ™‚ï¼šä¸çŒœæ¸¬ï¼Œç›´æ¥è©¢å•ä½¿ç”¨è€…ä»¥é‡æ¸…éœ€æ±‚\n</error_handling>","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[3568,320],"id":"89696b2d-b4da-4ef0-b4af-2009348b97f5","name":"AI Agent Tool"},{"parameters":{"public":true,"availableInChat":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[2624,208],"id":"a363a592-7d1d-4c3c-b3a5-108024d4e188","name":"When chat message received","webhookId":"44862d51-5423-47c1-acee-7d90be483cab"}],"connections":{"Azure OpenAI Chat Model":{"ai_languageModel":[[{"node":"Orchestrator","type":"ai_languageModel","index":0},{"node":"AI Agent Tool","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orchestrator","type":"ai_memory","index":0},{"node":"AI Agent Tool","type":"ai_memory","index":0}]]},"Wikipedia":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"serper search":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Execute a SQL query in Postgres":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"RAG Search Tool (Custom)":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"Orchestrator":{"main":[[]]},"AI Agent Tool":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Orchestrator","type":"main","index":0}]]}},"authors":"Young-Zen Chiu","name":"Version fdd684ef","description":"","autosaved":false},"tags":[]},{"updatedAt":"2026-01-08T11:17:01.234Z","createdAt":"2026-01-08T11:17:01.234Z","id":"JkPQLTN7JPUeqwQ6","name":"My workflow (Final Cloud IP Fix) copy","active":true,"isArchived":false,"nodes":[{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[2816,368],"id":"daade6e3-335f-4a98-af44-9c9a2461df54","name":"Azure OpenAI Chat Model","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[2976,544],"id":"037303ea-6498-45cd-857f-5fbbae588194","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolWikipedia","typeVersion":1,"position":[3136,544],"id":"acde57c5-0747-4a4a-9640-a9d47659cab6","name":"Wikipedia"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[3248,544],"id":"4cd4fcde-1cc7-46c0-a6ef-fa3666d81e71","name":"Calculator"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"6fe4047c8888d1c9109d10a0601e1bbe17e1e89c"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.3,"position":[3344,544],"id":"37471b8b-4c5f-4a13-ac20-0bf085983583","name":"serper search"},{"parameters":{"options":{"systemMessage":"=ç¾åœ¨çš„æ™‚é–“æ˜¯ï¼š{{ $now.format('yyyy-MM-dd HH:mm:ss') }}\n- è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n- é‡åˆ°çŸ¥è­˜åº«å’Œè³‡æ–™åº«ç›¸é—œå•é¡Œè«‹é€é Rag agent","maxIterations":10,"returnIntermediateSteps":true,"enableStreaming":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[3072,144],"id":"3d06a513-9cff-4b6c-82c2-631d7d30cbb6","name":"Orchestrator"},{"parameters":{"descriptionType":"manual","toolDescription":"ã€Œæ­¤å·¥å…·å¯ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµæ§‹èˆ‡å…§å®¹ã€‚ç•¶ä½¿ç”¨è€…è©¢å•è³‡æ–™è¡¨æ•¸é‡ã€åç¨±æˆ– schema è³‡è¨Šæ™‚ï¼Œè«‹ä½¿ç”¨æ­¤å·¥å…·åŸ·è¡Œ SQL æŸ¥è©¢ã€‚ã€","operation":"executeQuery","query":"SELECT count(*) AS table_count \nFROM information_schema.tables \nWHERE table_schema = 'public';","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[3664,512],"id":"2bf4e706-bac1-4873-912b-d4efc8a6aa6f","name":"Execute a SQL query in Postgres","credentials":{"postgres":{"id":"Bykxx4QHz6cqTLe8","name":"Postgres account"}}},{"parameters":{"name":"rag_search","description":"ä¸»è¦æœå°‹å·¥å…·ã€‚ç•¶ä½¿ç”¨è€…è©¢å•å…¬å¸æ–‡ä»¶ã€SOPã€æ¨™æ¡ˆè¦ç¯„ã€å‰¯ç¸½æŒ‡ç¤ºç­‰å…§å®¹æ™‚ï¼Œå¿…é ˆå„ªå…ˆä½¿ç”¨æ­¤å·¥å…·ã€‚è¼¸å…¥ç‚ºä½¿ç”¨è€…çš„æŸ¥è©¢å•é¡Œ(query)ã€‚","jsCode":"// Fixed variable shadowing AND URL\nconst userQuery = query;\n\n// Using user's cloud IP explicitly\nconst webhookUrl = 'http://159.223.50.159:5678/webhook/rag-search';\n\ntry {\n  const response = await this.helpers.request({\n    method: 'POST',\n    uri: webhookUrl,\n    body: {\n      query: userQuery\n    },\n    json: true\n  });\n\n  // Handle both possible response formats\n  if (response.response) {\n    return response.response;\n  }\n  return JSON.stringify(response);\n\n} catch (error) {\n  return \"Search failed: \" + error.message;\n}"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1,"position":[3792,512],"id":"a9abf4fe-3bf8-45b3-8a66-8152e3aa69f2","name":"RAG Search Tool (Custom)"},{"parameters":{"text":"=<agent_identity>\nä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ¨™æ¡ˆæ’°å¯«å°ˆå®¶èˆ‡è³‡æ–™æŸ¥è©¢åŠ©ç†ï¼Œå°ˆé–€å”åŠ©ä½¿ç”¨è€…æŸ¥è©¢è³‡æ–™åº«å’ŒçŸ¥è­˜åº«å…§éƒ¨ç›¸é—œè³‡è¨Šä¸¦ç”¢å‡ºå°ˆæ¥­å ±å‘Šã€‚\n</agent_identity>\n\n<core_mission>\nå”åŠ©ä½¿ç”¨è€…æŸ¥è©¢çŸ¥è­˜åº«è‚‹éƒ¨çš„æ¨™æ¡ˆSOPã€éå¾€æ¡ˆä¾‹ï¼Œä¸¦å°‡è³‡è¨Šæ•´ç†æˆå°ˆæ¥­çš„å ±å‘Šæ®µè½ã€‚\n</core_mission>\n\n<available_tools>\n<tool name=\"rag_search\" priority=\"highest\">\næ ¸å¿ƒå·¥å…·ã€‚ç•¶å•é¡Œæ¶‰åŠã€Œæ¨™æ¡ˆã€ã€ã€Œå°ˆæ¡ˆã€ã€ã€Œè¦ç« ã€ã€ã€ŒSOPã€ã€ã€Œå…§éƒ¨è¦å®šã€æ™‚ï¼Œå‹™å¿…å„ªå…ˆä½¿ç”¨ã€‚\n</tool>\n\n<tool name=\"postgres_sql\" priority=\"secondary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµ±è¨ˆæ•¸æ“šã€‚\n</tool>\n\n<tool name=\"wikipedia_serper\" priority=\"tertiary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢å¤–éƒ¨é€šç”¨çŸ¥è­˜ã€‚\n</tool>\n</available_tools>\n\n<strict_rules>\n<rule id=\"1\" name=\"å¿…é ˆæŸ¥è­‰\">\næœªç¶“ rag_search æŸ¥è­‰ï¼Œçµ•ä¸å¯æé€ å…¬å¸å…§éƒ¨è¦å®šã€‚è‹¥æŸ¥ç„¡çµæœï¼Œè«‹èª å¯¦å›è¦†ã€Œè³‡æ–™åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€ã€‚\n</rule>\n\n<rule id=\"2\" name=\"å·¥å…·å„ªå…ˆé †åº\">\næ¶‰åŠå…§éƒ¨è³‡è¨Š â†’ å…ˆç”¨ rag_search\næ¶‰åŠçµ±è¨ˆæ•¸æ“š â†’ ç”¨ postgres_sql\næ¶‰åŠå¤–éƒ¨çŸ¥è­˜ â†’ ç”¨ wikipedia/serper\n</rule>\n\n<rule id=\"3\" name=\"èªè¨€è¦ç¯„\">\nä¸€å¾‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n</rule>\n</strict_rules>\n\n<output_format>\nå›ç­”æ™‚å‹™å¿…ä¾ç…§ä»¥ä¸‹çµæ§‹ï¼š\n\n## ğŸ¯ æ ¸å¿ƒé‡é»\nç”¨åˆ—é»å¼æ‘˜è¦æŸ¥åˆ°çš„é—œéµäº‹å¯¦ã€‚\n\n## ğŸ’¡ å»¶ä¼¸è£œå……\né‡å°æ¨™æ¡ˆæ’°å¯«çš„å°ˆæ¥­å»ºè­°æˆ–æ³¨æ„äº‹é …ã€‚\n</output_format>\n\n<error_handling>\n- æŸ¥ç„¡è³‡æ–™æ™‚ï¼šæ˜ç¢ºå‘ŠçŸ¥ã€ŒçŸ¥è­˜åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€\n- è³‡è¨Šä¸å®Œæ•´æ™‚ï¼šèªªæ˜å·²æ‰¾åˆ°çš„éƒ¨åˆ†ï¼Œä¸¦å»ºè­°é€²ä¸€æ­¥æŸ¥è©¢æ–¹å‘\n- ä¸ç¢ºå®šæ™‚ï¼šä¸çŒœæ¸¬ï¼Œç›´æ¥è©¢å•ä½¿ç”¨è€…ä»¥é‡æ¸…éœ€æ±‚\n</error_handling>","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[3568,320],"id":"6ed50a48-3141-43c7-8186-3786bb0e5799","name":"AI Agent Tool"},{"parameters":{"public":true,"availableInChat":true,"options":{},"path":"3c2b9b96-3839-4cd9-81d1-ba4f7df8f18f"},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[2624,208],"id":"56c38ef5-93a0-467a-9be2-65d6d0a6c778","name":"When chat message received","webhookId":"3c2b9b96-3839-4cd9-81d1-ba4f7df8f18f"}],"connections":{"Azure OpenAI Chat Model":{"ai_languageModel":[[{"node":"Orchestrator","type":"ai_languageModel","index":0},{"node":"AI Agent Tool","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orchestrator","type":"ai_memory","index":0},{"node":"AI Agent Tool","type":"ai_memory","index":0}]]},"Wikipedia":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"serper search":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Execute a SQL query in Postgres":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"RAG Search Tool (Custom)":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"Orchestrator":{"main":[[]]},"AI Agent Tool":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Orchestrator","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"55390c10-34df-44bd-8a21-c896a706b545","activeVersionId":"55390c10-34df-44bd-8a21-c896a706b545","triggerCount":1,"shared":[{"updatedAt":"2026-01-08T11:17:01.239Z","createdAt":"2026-01-08T11:17:01.239Z","role":"workflow:owner","workflowId":"JkPQLTN7JPUeqwQ6","projectId":"s582lXybVche97ry"}],"activeVersion":{"updatedAt":"2026-01-08T11:17:08.000Z","createdAt":"2026-01-08T11:17:01.243Z","versionId":"55390c10-34df-44bd-8a21-c896a706b545","workflowId":"JkPQLTN7JPUeqwQ6","nodes":[{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[2816,368],"id":"daade6e3-335f-4a98-af44-9c9a2461df54","name":"Azure OpenAI Chat Model","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[2976,544],"id":"037303ea-6498-45cd-857f-5fbbae588194","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolWikipedia","typeVersion":1,"position":[3136,544],"id":"acde57c5-0747-4a4a-9640-a9d47659cab6","name":"Wikipedia"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[3248,544],"id":"4cd4fcde-1cc7-46c0-a6ef-fa3666d81e71","name":"Calculator"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"6fe4047c8888d1c9109d10a0601e1bbe17e1e89c"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.3,"position":[3344,544],"id":"37471b8b-4c5f-4a13-ac20-0bf085983583","name":"serper search"},{"parameters":{"options":{"systemMessage":"=ç¾åœ¨çš„æ™‚é–“æ˜¯ï¼š{{ $now.format('yyyy-MM-dd HH:mm:ss') }}\n- è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n- é‡åˆ°çŸ¥è­˜åº«å’Œè³‡æ–™åº«ç›¸é—œå•é¡Œè«‹é€é Rag agent","maxIterations":10,"returnIntermediateSteps":true,"enableStreaming":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[3072,144],"id":"3d06a513-9cff-4b6c-82c2-631d7d30cbb6","name":"Orchestrator"},{"parameters":{"descriptionType":"manual","toolDescription":"ã€Œæ­¤å·¥å…·å¯ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµæ§‹èˆ‡å…§å®¹ã€‚ç•¶ä½¿ç”¨è€…è©¢å•è³‡æ–™è¡¨æ•¸é‡ã€åç¨±æˆ– schema è³‡è¨Šæ™‚ï¼Œè«‹ä½¿ç”¨æ­¤å·¥å…·åŸ·è¡Œ SQL æŸ¥è©¢ã€‚ã€","operation":"executeQuery","query":"SELECT count(*) AS table_count \nFROM information_schema.tables \nWHERE table_schema = 'public';","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[3664,512],"id":"2bf4e706-bac1-4873-912b-d4efc8a6aa6f","name":"Execute a SQL query in Postgres","credentials":{"postgres":{"id":"Bykxx4QHz6cqTLe8","name":"Postgres account"}}},{"parameters":{"name":"rag_search","description":"ä¸»è¦æœå°‹å·¥å…·ã€‚ç•¶ä½¿ç”¨è€…è©¢å•å…¬å¸æ–‡ä»¶ã€SOPã€æ¨™æ¡ˆè¦ç¯„ã€å‰¯ç¸½æŒ‡ç¤ºç­‰å…§å®¹æ™‚ï¼Œå¿…é ˆå„ªå…ˆä½¿ç”¨æ­¤å·¥å…·ã€‚è¼¸å…¥ç‚ºä½¿ç”¨è€…çš„æŸ¥è©¢å•é¡Œ(query)ã€‚","jsCode":"// Fixed variable shadowing AND URL\nconst userQuery = query;\n\n// Using user's cloud IP explicitly\nconst webhookUrl = 'http://159.223.50.159:5678/webhook/rag-search';\n\ntry {\n  const response = await this.helpers.request({\n    method: 'POST',\n    uri: webhookUrl,\n    body: {\n      query: userQuery\n    },\n    json: true\n  });\n\n  // Handle both possible response formats\n  if (response.response) {\n    return response.response;\n  }\n  return JSON.stringify(response);\n\n} catch (error) {\n  return \"Search failed: \" + error.message;\n}"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1,"position":[3792,512],"id":"a9abf4fe-3bf8-45b3-8a66-8152e3aa69f2","name":"RAG Search Tool (Custom)"},{"parameters":{"text":"=<agent_identity>\nä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ¨™æ¡ˆæ’°å¯«å°ˆå®¶èˆ‡è³‡æ–™æŸ¥è©¢åŠ©ç†ï¼Œå°ˆé–€å”åŠ©ä½¿ç”¨è€…æŸ¥è©¢è³‡æ–™åº«å’ŒçŸ¥è­˜åº«å…§éƒ¨ç›¸é—œè³‡è¨Šä¸¦ç”¢å‡ºå°ˆæ¥­å ±å‘Šã€‚\n</agent_identity>\n\n<core_mission>\nå”åŠ©ä½¿ç”¨è€…æŸ¥è©¢çŸ¥è­˜åº«è‚‹éƒ¨çš„æ¨™æ¡ˆSOPã€éå¾€æ¡ˆä¾‹ï¼Œä¸¦å°‡è³‡è¨Šæ•´ç†æˆå°ˆæ¥­çš„å ±å‘Šæ®µè½ã€‚\n</core_mission>\n\n<available_tools>\n<tool name=\"rag_search\" priority=\"highest\">\næ ¸å¿ƒå·¥å…·ã€‚ç•¶å•é¡Œæ¶‰åŠã€Œæ¨™æ¡ˆã€ã€ã€Œå°ˆæ¡ˆã€ã€ã€Œè¦ç« ã€ã€ã€ŒSOPã€ã€ã€Œå…§éƒ¨è¦å®šã€æ™‚ï¼Œå‹™å¿…å„ªå…ˆä½¿ç”¨ã€‚\n</tool>\n\n<tool name=\"postgres_sql\" priority=\"secondary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµ±è¨ˆæ•¸æ“šã€‚\n</tool>\n\n<tool name=\"wikipedia_serper\" priority=\"tertiary\">\nå‚™ç”¨å·¥å…·ã€‚ç”¨æ–¼æŸ¥è©¢å¤–éƒ¨é€šç”¨çŸ¥è­˜ã€‚\n</tool>\n</available_tools>\n\n<strict_rules>\n<rule id=\"1\" name=\"å¿…é ˆæŸ¥è­‰\">\næœªç¶“ rag_search æŸ¥è­‰ï¼Œçµ•ä¸å¯æé€ å…¬å¸å…§éƒ¨è¦å®šã€‚è‹¥æŸ¥ç„¡çµæœï¼Œè«‹èª å¯¦å›è¦†ã€Œè³‡æ–™åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€ã€‚\n</rule>\n\n<rule id=\"2\" name=\"å·¥å…·å„ªå…ˆé †åº\">\næ¶‰åŠå…§éƒ¨è³‡è¨Š â†’ å…ˆç”¨ rag_search\næ¶‰åŠçµ±è¨ˆæ•¸æ“š â†’ ç”¨ postgres_sql\næ¶‰åŠå¤–éƒ¨çŸ¥è­˜ â†’ ç”¨ wikipedia/serper\n</rule>\n\n<rule id=\"3\" name=\"èªè¨€è¦ç¯„\">\nä¸€å¾‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚\n</rule>\n</strict_rules>\n\n<output_format>\nå›ç­”æ™‚å‹™å¿…ä¾ç…§ä»¥ä¸‹çµæ§‹ï¼š\n\n## ğŸ¯ æ ¸å¿ƒé‡é»\nç”¨åˆ—é»å¼æ‘˜è¦æŸ¥åˆ°çš„é—œéµäº‹å¯¦ã€‚\n\n## ğŸ’¡ å»¶ä¼¸è£œå……\né‡å°æ¨™æ¡ˆæ’°å¯«çš„å°ˆæ¥­å»ºè­°æˆ–æ³¨æ„äº‹é …ã€‚\n</output_format>\n\n<error_handling>\n- æŸ¥ç„¡è³‡æ–™æ™‚ï¼šæ˜ç¢ºå‘ŠçŸ¥ã€ŒçŸ¥è­˜åº«ä¸­ç„¡ç›¸é—œç´€éŒ„ã€\n- è³‡è¨Šä¸å®Œæ•´æ™‚ï¼šèªªæ˜å·²æ‰¾åˆ°çš„éƒ¨åˆ†ï¼Œä¸¦å»ºè­°é€²ä¸€æ­¥æŸ¥è©¢æ–¹å‘\n- ä¸ç¢ºå®šæ™‚ï¼šä¸çŒœæ¸¬ï¼Œç›´æ¥è©¢å•ä½¿ç”¨è€…ä»¥é‡æ¸…éœ€æ±‚\n</error_handling>","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[3568,320],"id":"6ed50a48-3141-43c7-8186-3786bb0e5799","name":"AI Agent Tool"},{"parameters":{"public":true,"availableInChat":true,"options":{},"path":"3c2b9b96-3839-4cd9-81d1-ba4f7df8f18f"},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[2624,208],"id":"56c38ef5-93a0-467a-9be2-65d6d0a6c778","name":"When chat message received","webhookId":"3c2b9b96-3839-4cd9-81d1-ba4f7df8f18f"}],"connections":{"Azure OpenAI Chat Model":{"ai_languageModel":[[{"node":"Orchestrator","type":"ai_languageModel","index":0},{"node":"AI Agent Tool","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orchestrator","type":"ai_memory","index":0},{"node":"AI Agent Tool","type":"ai_memory","index":0}]]},"Wikipedia":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"serper search":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Execute a SQL query in Postgres":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"RAG Search Tool (Custom)":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"Orchestrator":{"main":[[]]},"AI Agent Tool":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Orchestrator","type":"main","index":0}]]}},"authors":"Young-Zen Chiu","name":"Version 55390c10","description":"","autosaved":false},"tags":[]},{"updatedAt":"2026-01-08T10:14:14.335Z","createdAt":"2026-01-08T09:21:53.205Z","id":"OYckNbB4uXssRWsWMJ24c","name":"Tool - Hybrid Search (Webhook)","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"rag-search","responseMode":"lastNode","options":{}},"id":"60d1b29f-58fd-488d-a890-900684ba5bef","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[11888,1664],"webhookId":"rag-search-webhook-id"},{"parameters":{"jsCode":"// Robust Input Parsing\nconst data = $input.first().json;\nlet query = '';\nif (typeof data.body === 'object' && data.body.query) {\n    query = data.body.query;\n} else if (data.query) {\n    query = data.query;\n} else if (data.body) {\n    query = JSON.stringify(data.body);\n}\n\nif (!query) query = 'test query';\nreturn [{ json: { query: query } }];"},"id":"8fe11c08-ff5c-4dd9-add8-4f18051ee7f7","name":"Parse Input","type":"n8n-nodes-base.code","typeVersion":2,"position":[12112,1664]},{"parameters":{"method":"POST","url":"https://ocrgpt4.openai.azure.com/openai/deployments/text-embedding-3-small/embeddings?api-version=2024-02-01","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api-key","value":"ba6946b167174ece95e7419976aa6a33"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ input: $json.query }) }}","options":{}},"id":"1b3f6cbd-5802-42f3-aa66-bac82b4ded15","name":"Azure Embed Query","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[12336,1664]},{"parameters":{"method":"POST","url":"https://goyonrowhfphooryfzif.supabase.co/rest/v1/rpc/match_chunks_hybrid","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ query_text: $('Parse Input').first().json.query || '', query_embedding: $json.data[0].embedding, match_threshold: 0.0, match_count: 20, filter_project_id: null }) }}","options":{}},"alwaysOutputData":true,"id":"ea8658f5-bf3b-4ff1-9a91-eb65f1c6fe2f","name":"Supabase Hybrid Search","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[12560,1664],"credentials":{"supabaseApi":{"id":"Rblv0nhyrDw2qTU1","name":"Supabase account"}}},{"parameters":{"jsCode":"// Prepare chunks for Reranking\nconst items = $input.all();\nconst chunks = [];\n\nfor (const item of items) {\n    const data = item.json;\n    if (Array.isArray(data)) {\n        chunks.push(...data);\n    } else if (data.content) {\n        chunks.push(data);\n    }\n}\n\n// Pass FULL content to LLM\nconst candidatesConfig = chunks.map((c, index) => ({\n    id: c.id,\n    index: index,\n    content: c.content || '' \n}));\n\nconst query = $('Parse Input').first().json.query;\n\nreturn [{\n    json: {\n        query,\n        candidates: candidatesConfig,\n        original_chunks: chunks\n    }\n}];"},"id":"864e745a-9e40-46a8-a5e5-7b9a001fab98","name":"Prepare Rerank","type":"n8n-nodes-base.code","typeVersion":2,"position":[12768,1664]},{"parameters":{"method":"POST","url":"https://ocrgpt4.openai.azure.com/openai/deployments/gpt-4.1/chat/completions?api-version=2024-02-01","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api-key","value":"ba6946b167174ece95e7419976aa6a33"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ messages: [{ role: 'system', content: 'You are a Relevance Reranking Expert. Your task is to filter out irrelevant documents and identify the KEY QUOTE that matches the user query.\\n\\nUser Query: ' + $json.query + '\\n\\nCandidates:\\n' + JSON.stringify($json.candidates) + '\\n\\nINSTRUCTIONS:\\n1. Analyze each candidate against the User Query.\\n2. If relevant, extract the EXACT passage (max 100 chars) that answers the query as \"quote\".\\n3. Return a JSON Object with a key \"ranked_items\" containing a list of relevant objects.\\nExample: { \"ranked_items\": [{ \"id\": \"uuid1\", \"quote\": \"The VP focuses on revenue...\" }] }\\nReturn ONLY JSON.' }], response_format: { type: \"json_object\" } }) }}","options":{"timeout":60000}},"id":"7c5a33e5-840a-4182-9a61-a2c4f91d950c","name":"LLM Rerank","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[12992,1664]},{"parameters":{"jsCode":"// Apply Reranking Filter\nconst llmContent = $input.first().json.choices[0].message.content;\nlet validItems = [];\n\ntry {\n    const cleanContent = llmContent.replace(/```json\\n|\\n```/g, '');\n    const parsed = JSON.parse(cleanContent);\n    validItems = parsed.ranked_items || [];\n} catch (e) {\n    const all = $('Prepare Rerank').first().json.original_chunks;\n    validItems = all.slice(0, 3).map(c => ({ id: c.id, quote: null }));\n}\n\nconst allChunks = $('Prepare Rerank').first().json.original_chunks;\nconst finalChunks = [];\n\nfor (const item of validItems) {\n    const original = allChunks.find(c => c.id === item.id);\n    if (original) {\n        finalChunks.push({\n            ...original,\n            ai_quote: item.quote\n        });\n    }\n}\n\nlet context = 'ï¼ˆç„¡åŒ¹é…è³‡æ–™ï¼‰';\nif (finalChunks.length > 0) {\n  context = finalChunks.map(c => {\n      return `[Source: ${c.source_title || 'Unknown'}]\\nContent: ${c.content}\\nFocus: ${c.ai_quote || ''}`;\n  }).join('\\n---\\n');\n}\n\nreturn [{\n  json: {\n    response: context\n  }\n}];"},"id":"3fcbb211-9c0b-4174-bb5a-43d751269e1e","name":"Format Output","type":"n8n-nodes-base.code","typeVersion":2,"position":[13216,1664]}],"connections":{"Webhook":{"main":[[{"node":"Parse Input","type":"main","index":0}]]},"Parse Input":{"main":[[{"node":"Azure Embed Query","type":"main","index":0}]]},"Azure Embed Query":{"main":[[{"node":"Supabase Hybrid Search","type":"main","index":0}]]},"Supabase Hybrid Search":{"main":[[{"node":"Prepare Rerank","type":"main","index":0}]]},"Prepare Rerank":{"main":[[{"node":"LLM Rerank","type":"main","index":0}]]},"LLM Rerank":{"main":[[{"node":"Format Output","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"d656dd2d-10df-496c-a05c-f88ca9811927","activeVersionId":"d656dd2d-10df-496c-a05c-f88ca9811927","triggerCount":1,"shared":[{"updatedAt":"2026-01-08T09:21:53.219Z","createdAt":"2026-01-08T09:21:53.219Z","role":"workflow:owner","workflowId":"OYckNbB4uXssRWsWMJ24c","projectId":"s582lXybVche97ry"}],"activeVersion":{"updatedAt":"2026-01-08T10:14:15.000Z","createdAt":"2026-01-08T10:14:14.339Z","versionId":"d656dd2d-10df-496c-a05c-f88ca9811927","workflowId":"OYckNbB4uXssRWsWMJ24c","nodes":[{"parameters":{"httpMethod":"POST","path":"rag-search","responseMode":"lastNode","options":{}},"id":"60d1b29f-58fd-488d-a890-900684ba5bef","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[11888,1664],"webhookId":"rag-search-webhook-id"},{"parameters":{"jsCode":"// Robust Input Parsing\nconst data = $input.first().json;\nlet query = '';\nif (typeof data.body === 'object' && data.body.query) {\n    query = data.body.query;\n} else if (data.query) {\n    query = data.query;\n} else if (data.body) {\n    query = JSON.stringify(data.body);\n}\n\nif (!query) query = 'test query';\nreturn [{ json: { query: query } }];"},"id":"8fe11c08-ff5c-4dd9-add8-4f18051ee7f7","name":"Parse Input","type":"n8n-nodes-base.code","typeVersion":2,"position":[12112,1664]},{"parameters":{"method":"POST","url":"https://ocrgpt4.openai.azure.com/openai/deployments/text-embedding-3-small/embeddings?api-version=2024-02-01","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api-key","value":"ba6946b167174ece95e7419976aa6a33"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ input: $json.query }) }}","options":{}},"id":"1b3f6cbd-5802-42f3-aa66-bac82b4ded15","name":"Azure Embed Query","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[12336,1664]},{"parameters":{"method":"POST","url":"https://goyonrowhfphooryfzif.supabase.co/rest/v1/rpc/match_chunks_hybrid","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ query_text: $('Parse Input').first().json.query || '', query_embedding: $json.data[0].embedding, match_threshold: 0.0, match_count: 20, filter_project_id: null }) }}","options":{}},"alwaysOutputData":true,"id":"ea8658f5-bf3b-4ff1-9a91-eb65f1c6fe2f","name":"Supabase Hybrid Search","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[12560,1664],"credentials":{"supabaseApi":{"id":"Rblv0nhyrDw2qTU1","name":"Supabase account"}}},{"parameters":{"jsCode":"// Prepare chunks for Reranking\nconst items = $input.all();\nconst chunks = [];\n\nfor (const item of items) {\n    const data = item.json;\n    if (Array.isArray(data)) {\n        chunks.push(...data);\n    } else if (data.content) {\n        chunks.push(data);\n    }\n}\n\n// Pass FULL content to LLM\nconst candidatesConfig = chunks.map((c, index) => ({\n    id: c.id,\n    index: index,\n    content: c.content || '' \n}));\n\nconst query = $('Parse Input').first().json.query;\n\nreturn [{\n    json: {\n        query,\n        candidates: candidatesConfig,\n        original_chunks: chunks\n    }\n}];"},"id":"864e745a-9e40-46a8-a5e5-7b9a001fab98","name":"Prepare Rerank","type":"n8n-nodes-base.code","typeVersion":2,"position":[12768,1664]},{"parameters":{"method":"POST","url":"https://ocrgpt4.openai.azure.com/openai/deployments/gpt-4.1/chat/completions?api-version=2024-02-01","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api-key","value":"ba6946b167174ece95e7419976aa6a33"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ messages: [{ role: 'system', content: 'You are a Relevance Reranking Expert. Your task is to filter out irrelevant documents and identify the KEY QUOTE that matches the user query.\\n\\nUser Query: ' + $json.query + '\\n\\nCandidates:\\n' + JSON.stringify($json.candidates) + '\\n\\nINSTRUCTIONS:\\n1. Analyze each candidate against the User Query.\\n2. If relevant, extract the EXACT passage (max 100 chars) that answers the query as \"quote\".\\n3. Return a JSON Object with a key \"ranked_items\" containing a list of relevant objects.\\nExample: { \"ranked_items\": [{ \"id\": \"uuid1\", \"quote\": \"The VP focuses on revenue...\" }] }\\nReturn ONLY JSON.' }], response_format: { type: \"json_object\" } }) }}","options":{"timeout":60000}},"id":"7c5a33e5-840a-4182-9a61-a2c4f91d950c","name":"LLM Rerank","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[12992,1664]},{"parameters":{"jsCode":"// Apply Reranking Filter\nconst llmContent = $input.first().json.choices[0].message.content;\nlet validItems = [];\n\ntry {\n    const cleanContent = llmContent.replace(/```json\\n|\\n```/g, '');\n    const parsed = JSON.parse(cleanContent);\n    validItems = parsed.ranked_items || [];\n} catch (e) {\n    const all = $('Prepare Rerank').first().json.original_chunks;\n    validItems = all.slice(0, 3).map(c => ({ id: c.id, quote: null }));\n}\n\nconst allChunks = $('Prepare Rerank').first().json.original_chunks;\nconst finalChunks = [];\n\nfor (const item of validItems) {\n    const original = allChunks.find(c => c.id === item.id);\n    if (original) {\n        finalChunks.push({\n            ...original,\n            ai_quote: item.quote\n        });\n    }\n}\n\nlet context = 'ï¼ˆç„¡åŒ¹é…è³‡æ–™ï¼‰';\nif (finalChunks.length > 0) {\n  context = finalChunks.map(c => {\n      return `[Source: ${c.source_title || 'Unknown'}]\\nContent: ${c.content}\\nFocus: ${c.ai_quote || ''}`;\n  }).join('\\n---\\n');\n}\n\nreturn [{\n  json: {\n    response: context\n  }\n}];"},"id":"3fcbb211-9c0b-4174-bb5a-43d751269e1e","name":"Format Output","type":"n8n-nodes-base.code","typeVersion":2,"position":[13216,1664]}],"connections":{"Webhook":{"main":[[{"node":"Parse Input","type":"main","index":0}]]},"Parse Input":{"main":[[{"node":"Azure Embed Query","type":"main","index":0}]]},"Azure Embed Query":{"main":[[{"node":"Supabase Hybrid Search","type":"main","index":0}]]},"Supabase Hybrid Search":{"main":[[{"node":"Prepare Rerank","type":"main","index":0}]]},"Prepare Rerank":{"main":[[{"node":"LLM Rerank","type":"main","index":0}]]},"LLM Rerank":{"main":[[{"node":"Format Output","type":"main","index":0}]]}},"authors":"Young-Zen Chiu","name":"Version d656dd2d","description":"","autosaved":false},"tags":[]},{"updatedAt":"2026-01-08T09:07:26.683Z","createdAt":"2026-01-08T06:23:35.271Z","id":"P_cin1SC_Mp5gTLtx6v1W","name":"My workflow","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{"allowFileUploads":true}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[0,0],"id":"4a64cde3-b631-40bd-a655-5397847cf150","name":"When chat message received","webhookId":"9f19cd3c-996a-4de2-8217-1224151a6951"},{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[80,208],"id":"12fadad5-4971-4cb5-ab54-c769f1a47fd8","name":"Azure OpenAI Chat Model","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[224,208],"id":"aeeea2ee-5e62-4878-8bc1-18b96adf5fda","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolWikipedia","typeVersion":1,"position":[432,208],"id":"d1be3aed-c579-4019-87c2-5da617865665","name":"Wikipedia"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[528,208],"id":"efee090c-0a1d-42b5-bcd4-3e136b970e25","name":"Calculator"},{"parameters":{"content":"## Orchestrator\n","width":256,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[192,-48],"id":"6835c19d-ed3c-44f4-b516-5e9d014b49f8","name":"Sticky Note"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"6fe4047c8888d1c9109d10a0601e1bbe17e1e89c"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"},{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', ``, 'string') }}"},{"name":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Name', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', ``, 'string') }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.3,"position":[640,208],"id":"5a691b4b-92e5-488a-878a-e49f1305b71f","name":"serper search"},{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAzureOpenAi","typeVersion":1,"position":[704,-208],"id":"3e8e1a2e-b537-4429-98ac-8d36d885dcd5","name":"Azure OpenAI Chat Model1","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}},{"parameters":{"options":{"systemMessage":"=1.ä»¥ç¹é«”ä¸­æ–‡å›è¦†\n2.ç¾åœ¨çš„æ™‚é–“æ˜¯ï¼š{{ $now.format('yyyy-MM-dd HH:mm:ss') }}\n3.è³‡æ–™æŸ¥è©¢è«‹æ‰¾supabase agent","maxIterations":10,"returnIntermediateSteps":true,"passthroughBinaryImages":true,"enableStreaming":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[208,0],"id":"a5117c48-1859-4d92-9a46-e1600fa03602","name":"Orchestrator"},{"parameters":{"promptType":"define","text":"={{ $json.output }}","options":{"systemMessage":"1.ä»¥ç¹é«”ä¸­æ–‡å›è¦†","maxIterations":10,"returnIntermediateSteps":true,"passthroughBinaryImages":true,"enableStreaming":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[800,-384],"id":"1cfaf9f6-e9aa-4801-9c70-8d71899539ad","name":"supabase"},{"parameters":{"descriptionType":"manual","toolDescription":"ã€Œæ­¤å·¥å…·å¯ç”¨æ–¼æŸ¥è©¢è³‡æ–™åº«çµæ§‹èˆ‡å…§å®¹ã€‚ç•¶ä½¿ç”¨è€…è©¢å•è³‡æ–™è¡¨æ•¸é‡ã€åç¨±æˆ– schema è³‡è¨Šæ™‚ï¼Œè«‹ä½¿ç”¨æ­¤å·¥å…·åŸ·è¡Œ SQL æŸ¥è©¢ã€‚ã€","operation":"executeQuery","query":"SELECT count(*) AS table_count \nFROM information_schema.tables \nWHERE table_schema = 'public';\n\nSELECT table_name\nFROM information_schema.tables\nWHERE table_schema = 'public';\n\nSELECT column_name, data_type\nFROM information_schema.columns\nWHERE table_schema = 'public'\n  AND table_name = 'document_embeddings';","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[992,-208],"id":"73c99acc-1b2c-495e-b9f3-7aa4c3d2227e","name":"Execute a SQL query in Postgres","credentials":{"postgres":{"id":"Bykxx4QHz6cqTLe8","name":"Postgres account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[848,-208],"id":"13937e13-49e2-4742-993d-af26d52a326c","name":"Simple Memory1"},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"ã€Œé€™æ˜¯å…¬å¸å…§éƒ¨å°ˆæ¡ˆçš„å‘é‡çŸ¥è­˜åº«ã€","tableName":{"__rl":true,"value":"document_embeddings","mode":"list","cachedResultName":"document_embeddings"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1168,-240],"id":"241142f9-6293-4e90-b00d-b827797f707b","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"Rblv0nhyrDw2qTU1","name":"Supabase account"}}},{"parameters":{"model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsAzureOpenAi","typeVersion":1,"position":[1120,-32],"id":"0761cdd1-b33d-433f-9f2b-68fad585ea2a","name":"Embeddings Azure OpenAI","credentials":{"azureOpenAiApi":{"id":"BKbkJBvHVr8Vg5DL","name":"Azure Open AI account"}}}],"connections":{"When chat message received":{"main":[[{"node":"Orchestrator","type":"main","index":0}]]},"Azure OpenAI Chat Model":{"ai_languageModel":[[{"node":"Orchestrator","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orchestrator","type":"ai_memory","index":0}]]},"Wikipedia":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"serper search":{"ai_tool":[[{"node":"Orchestrator","type":"ai_tool","index":0}]]},"Azure OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supabase","type":"ai_languageModel","index":0}]]},"Orchestrator":{"main":[[{"node":"supabase","type":"main","index":0}]]},"Execute a SQL query in Postgres":{"ai_tool":[[{"node":"supabase","type":"ai_tool","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"supabase","type":"ai_memory","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"supabase","type":"ai_tool","index":0}]]},"Embeddings Azure OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false,"timeSavedMode":"fixed","timezone":"Asia/Taipei","callerPolicy":"workflowsFromSameOwner"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"cbb83112-21a5-4187-a30a-944d0c3b1fc7","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-08T06:23:35.276Z","createdAt":"2026-01-08T06:23:35.276Z","role":"workflow:owner","workflowId":"P_cin1SC_Mp5gTLtx6v1W","projectId":"s582lXybVche97ry"}],"activeVersion":null,"tags":[]}],"nextCursor":null}