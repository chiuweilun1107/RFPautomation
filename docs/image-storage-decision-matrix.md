# 圖片儲存方案決策矩陣

**用途**: 快速評估何時該重新考慮遷移
**適用**: 技術負責人、架構師、DevOps
**更新頻率**: 每季度 (Q1, Q2, Q3, Q4)

---

## 1. 快速決策表 (Quick Decision Table)

### 何時該堅持 Supabase Storage? ✅

| 條件 | 閾值 | 當前狀態 |
|------|------|---------|
| 月活躍專案數 | < 500 個 | ✅ ~100 個 |
| 總儲存用量 | < 80GB | ✅ ~1GB |
| 月頻寬用量 | < 200GB | ✅ ~10GB |
| 圖片載入時間 (P95) | < 2s | ✅ ~1.2s |
| 進階功能需求 | 無明確需求 | ✅ 無 |
| 團隊規模 | < 5 人 | ✅ 2-3 人 |
| 預算 | < $50/月 | ✅ $25/月 |

**結論**: ✅ 所有條件符合，維持現狀

---

### 何時該考慮 Cloudinary? ⚠️

| 警示條件 | 閾值 | 觸發動作 |
|---------|------|---------|
| **儲存超標** | > 90GB | 🔴 立即遷移或升級 Supabase 更高方案 |
| **頻寬超標** | > 230GB/月 | 🔴 立即遷移或優化圖片 |
| **效能劣化** | P95 > 3s | 🟡 調查瓶頸 → 若 CDN 問題則遷移 |
| **用戶投訴** | > 5 次/週 | 🟡 分析原因 → 若圖片載入慢則遷移 |
| **新功能需求** | 需要 AI 圖片處理 | 🟡 評估 Cloudinary AI 功能 ROI |
| **專案類型轉變** | 轉向電商/社交 | 🟡 重新評估架構 |
| **成本壓力** | Supabase > $100/月 | 🟡 比較 Cloudinary 成本 |

---

## 2. 詳細決策流程圖

```
開始
  │
  ▼
[定期檢查儲存用量]
  │
  ├─> 儲存 < 80GB? ──YES──> [檢查頻寬]
  │                           │
  └─> NO ──> [儲存超標]       ├─> 頻寬 < 200GB? ──YES──> [檢查效能]
              │               │                           │
              ▼               └─> NO ──> [頻寬超標]       ├─> P95 < 2s? ──YES──> ✅ 維持現狀
         [方案評估]                      │                │
              │                          ▼                └─> NO ──> [效能問題]
              │                     [方案評估]                         │
              │                          │                             ▼
              └──────────────────────────┴─────────────────────> [決策矩陣]
                                                                       │
                                                                       ▼
                                                         [計算 ROI & 遷移成本]
                                                                       │
                                           ┌───────────────────────────┴─────────────────────┐
                                           │                                                 │
                                           ▼                                                 ▼
                                    ROI > 2x 遷移成本?                             ROI < 2x 遷移成本?
                                           │                                                 │
                                           ▼                                                 ▼
                                    🟢 執行遷移                                    🔴 暫緩遷移
                                    (Cloudinary)                                  (優化現狀)
```

---

## 3. 方案對照矩陣 (Solution Comparison Matrix)

### 3.1 功能對照表

| 功能 | Supabase Storage | Cloudinary | 自建 MinIO | 重要性 |
|------|-----------------|------------|-----------|-------|
| **基礎儲存** | ✅ | ✅ | ✅ | 🔥🔥🔥 |
| **全球 CDN** | ✅ (Cloudflare) | ✅ (自家+Akamai) | ⚠️ (需額外接) | 🔥🔥🔥 |
| **自動壓縮** | ❌ | ✅ | ❌ | 🔥🔥 |
| **響應式圖片** | ❌ | ✅ | ❌ | 🔥 |
| **WebP/AVIF 轉換** | ❌ | ✅ | ❌ | 🔥 |
| **AI 圖片處理** | ❌ | ✅ | ❌ | 🔥 (低需求) |
| **URL 轉換** | ❌ | ✅ | ❌ | 🔥 |
| **非圖片檔案支援** | ✅ | ⚠️ (有限) | ✅ | 🔥🔥🔥 |
| **Supabase 整合** | ✅ (原生) | ❌ | ❌ | 🔥🔥 |
| **RLS 安全** | ✅ | ❌ | ❌ | 🔥🔥 |

### 3.2 成本對照表 (月費)

| 用量級別 | Supabase | Cloudinary | 自建 MinIO | 最優方案 |
|---------|---------|-----------|-----------|---------|
| **小型** (1GB, 10GB 頻寬) | $0 (Free) | $0 (Free) | $0 (VM 已有) | Supabase ✅ (整合最佳) |
| **中型** (10GB, 100GB 頻寬) | $25 (Pro) | $10-15 | $0 | Cloudinary 🟡 (但需權衡整合成本) |
| **大型** (100GB, 500GB 頻寬) | $100+ | $50-80 | $20 (CDN) | 自建 🟡 (需 DevOps 人力) |
| **超大型** (1TB, 5TB 頻寬) | $500+ | $300-500 | $100 (CDN) | 自建 ✅ (成本最優) |

**當前階段**: 小型 → Supabase 最適合

---

## 4. ROI 計算公式 (Return on Investment)

### 4.1 遷移成本估算

**一次性成本** (Supabase → Cloudinary):
```
遷移成本 = 開發工時 + 測試工時 + 資料遷移風險成本

開發工時 = 8 人天 × $500/天 = $4,000
測試工時 = 3 人天 × $500/天 = $1,500
風險成本 = 系統停機損失 + 回滾成本 = $1,000
----------------------------------------
總成本 = $6,500
```

**持續成本差異** (每月):
```
Supabase Pro:    $25/月
Cloudinary Paid: $15/月 (預估)
-----------------------
省下: $10/月

但需考慮:
+ 額外維護工時: 2 小時/月 × $50/時 = $100/月
+ 監控工具成本: $10/月
-----------------------
實際增加: $100/月 ❌
```

### 4.2 ROI 計算

```
投資回報期 (Break-even) = 遷移成本 / 每月節省
                       = $6,500 / (-$100)
                       = 永遠不會回本 ❌
```

**結論**: 當前階段遷移到 Cloudinary **ROI 為負**，不建議遷移。

---

## 5. 重新評估時程表 (Re-evaluation Schedule)

### 2026 Q1 (當前)

**決策**: ✅ 維持 Supabase Storage
**理由**: 用量低、成本低、整合好
**下次評估**: 2026-07-29 (6 個月後)

### 2026 Q3 (預定評估)

**評估內容**:
1. 檢查儲存用量是否 > 50GB
2. 檢查頻寬用量是否 > 150GB/月
3. 檢查用戶投訴是否增加
4. 檢查是否有新功能需求 (如電商產品圖)
5. 比較 Cloudinary 最新定價

**決策準則**:
- 若任一條件觸發 → 啟動遷移評估
- 若所有條件良好 → 延後至 2027 Q1 評估

### 2027 Q1 (未來評估)

**預期狀況**:
- 專案數: 500+
- 儲存用量: 5-10GB
- 頻寬用量: 50-100GB/月

**可能決策**:
- 若接近 Supabase Pro 限制 → 考慮遷移或升級
- 若效能劣化 → 立即遷移

---

## 6. 決策檢查清單 (Decision Checklist)

### 評估前準備 (Pre-evaluation)

- [ ] 匯出最近 3 個月的用量數據
- [ ] 檢查 Supabase Dashboard 儲存/頻寬趨勢
- [ ] 收集用戶投訴紀錄 (若有)
- [ ] 查看最新 Cloudinary 定價
- [ ] 評估團隊工時成本

### 評估過程 (During evaluation)

- [ ] 計算當前月費 (Supabase)
- [ ] 計算預期月費 (Cloudinary)
- [ ] 計算遷移工時 (人天)
- [ ] 計算 ROI (Break-even 時間)
- [ ] 評估進階功能需求 (是否真的需要)

### 決策後確認 (Post-decision)

- [ ] 文檔化決策理由 (更新本文檔)
- [ ] 通知相關團隊 (前端、後端、DevOps)
- [ ] 若決定遷移 → 建立詳細實施計劃
- [ ] 若決定維持 → 設定下次評估日期

---

## 7. 常見問題 FAQ (Frequently Asked Questions)

### Q1: 為什麼不一開始就用 Cloudinary?

**A**:
- 過早優化 (Premature Optimization) 違反架構原則
- 增加不必要複雜度與外部依賴
- Supabase 整合更好 (統一認證、RLS)
- 成本不確定性高 (用量上升後費用難預測)

### Q2: 如果 Supabase Storage 掛掉怎麼辦?

**A**:
- Supabase 提供 99.9% SLA (每月最多停機 43 分鐘)
- 可設定 Supabase Storage 自動備份至 S3
- Cloudinary 也可能掛掉 (無單點故障免疫方案)
- 關鍵: 實施監控與告警，而非預設性遷移

### Q3: 未來如何無痛遷移到 Cloudinary?

**A**:
遷移策略 (Incremental Migration):
1. 新上傳走 Cloudinary
2. 前端加入 URL 判斷邏輯 (Supabase vs Cloudinary)
3. 背景 Job 逐步遷移舊檔案
4. 監控成本與效能
5. 確認穩定後關閉 Supabase Storage

### Q4: 有沒有折衷方案?

**A**:
可行折衷方案:
- 方案 1: 僅對 AI 生成圖片使用 Cloudinary (其他用 Supabase)
- 方案 2: 使用 Cloudinary Free 方案 + Supabase Storage 混合
- 方案 3: 實施更激進的壓縮策略 (Quality: 70%)

但仍建議: **先優化現狀再考慮混合**，避免過早複雜化。

### Q5: 競品都用 Cloudinary，我們不用會落後嗎?

**A**:
- 技術選型不應盲目跟風，應基於實際需求
- 標案助手系統非圖片密集型應用 (不同於電商/社交)
- Supabase + 壓縮優化已能滿足 95% 使用場景
- 若未來轉型為圖片密集應用，再遷移不遲

---

## 8. 相關文檔

- [ADR-001: 圖片儲存架構決策](/Users/chiuyongren/Desktop/AI dev/docs/ADR-001-image-storage-architecture.md)
- [圖片儲存優化實施指南](/Users/chiuyongren/Desktop/AI dev/docs/image-storage-implementation-guide.md)

---

**維護者**: Leo (系統架構師)
**首次建立**: 2026-01-29
**下次評估**: 2026-07-29
**版本**: 1.0
