# 圖片儲存架構文檔索引

**主題**: 圖片儲存方案評估與決策
**決策日期**: 2026-01-29
**架構師**: Leo
**狀態**: ✅ 已決策 - 維持 Supabase Storage

---

## 📋 執行摘要 (Executive Summary)

### 核心問題
**我們應該將圖片儲存從 Supabase Storage 遷移到 Cloudinary 嗎？**

### 最終決策
**✅ 維持 Supabase Storage (All-in-One 架構)**

### 關鍵理由
1. **成本最優**: 24 個月 TCO 僅 $502 (Cloudinary 為 $9,610，差距 18 倍)
2. **零遷移風險**: 無需改動程式碼，團隊可專注核心業務
3. **整合優勢**: 統一認證、RLS 安全、單一管理平台
4. **符合 YAGNI**: 目前無證據顯示效能不足或需要進階功能
5. **可逆性高**: 未來若需要仍可無痛遷移 (S3 相容 API)

### 預期效果
- 實施圖片壓縮優化 → 儲存減少 60%、頻寬減少 60%
- 延長 Free 方案使用時間 6 個月
- 節省 $757-$4,348 (相比其他方案，24 個月)

---

## 📚 文檔清單 (Document List)

### 1. [ADR-001: 圖片儲存架構決策](./ADR-001-image-storage-architecture.md) 🔥 必讀
**用途**: 完整架構決策記錄
**內容**:
- 背景與問題定義
- 4 種方案詳細比較 (Supabase, Cloudinary, 混合, 自建)
- 效能分析 (CDN 效能、載入速度)
- 遷移成本評估 (程式碼變更、資料遷移)
- 功能需求分析
- 風險與緩解措施
- 決策理由與實施計劃

**何時閱讀**: 需要理解完整決策脈絡時

---

### 2. [圖片儲存優化實施指南](./image-storage-implementation-guide.md) 🔥 必讀
**用途**: 技術實施操作手冊
**內容**:
- 系統架構圖 (現狀 vs 優化後)
- 階段 1: 前端圖片壓縮 (Sharp.js)
- 階段 2: CDN 快取優化 (SQL Migration)
- 階段 3: 用量監控與告警
- 完整程式碼範例
- 測試計劃與成功指標
- 時程表 (18 小時工時)

**何時閱讀**: 需要實際動手實施優化時

---

### 3. [圖片儲存決策矩陣](./image-storage-decision-matrix.md) 🟡 參考
**用途**: 快速決策參考表
**內容**:
- 何時該堅持 Supabase?
- 何時該考慮 Cloudinary?
- 決策流程圖
- 方案對照矩陣
- ROI 計算公式
- 重新評估時程表
- FAQ 常見問題

**何時閱讀**: 未來 (6/12/24 個月) 重新評估時

---

### 4. [圖片儲存成本分析](./image-storage-cost-analysis.md) 🟡 參考
**用途**: 精確成本試算
**內容**:
- 使用量成長預測 (當前 → 24 個月)
- 4 種方案詳細成本試算
- 累積成本對照表
- Break-even 分析 (Cloudinary 何時更划算?)
- 隱性成本分析 (開發、維護)
- 全生命週期成本 (TCO)
- 風險調整後成本
- 成本優化建議
- Excel 計算公式

**何時閱讀**: 需要向管理層報告成本時

---

## 🎯 快速決策指南 (Quick Decision Guide)

### 當前狀態 (2026 Q1)

| 指標 | 當前值 | 閾值 | 狀態 |
|------|-------|------|------|
| 活躍專案數 | ~100 個 | < 500 | ✅ 正常 |
| 總儲存用量 | ~1GB | < 80GB | ✅ 正常 |
| 月頻寬用量 | ~10GB | < 200GB | ✅ 正常 |
| 圖片載入時間 (P95) | ~1.2s | < 2s | ✅ 正常 |
| 月成本 | $0.72 | < $50 | ✅ 正常 |

**結論**: ✅ 所有指標健康，維持 Supabase Storage

---

### 何時該重新評估?

⚠️ **觸發條件** (任一滿足即啟動評估):
1. 儲存用量 > 90GB (接近 Supabase Pro 限制)
2. 頻寬用量 > 230GB/月 (Cloudinary break-even 點)
3. 圖片載入時間 P95 > 3s
4. 用戶投訴 > 5 次/週
5. 新功能明確需要 AI 圖片處理

⏰ **定期評估日期**:
- 下次評估: 2026-07-29 (6 個月後)
- 年度評估: 2027-01-29

---

## 🚀 立即行動清單 (Action Items)

### Week 1 (2026-02-05)
- [ ] 實施圖片壓縮 (UploadZone) - 4 小時
- [ ] 實施圖片壓縮 (ImageGeneration) - 3 小時
- [ ] CDN 快取優化 (SQL Migration) - 2 小時

### Week 2 (2026-02-12)
- [ ] 用量監控介面 - 4 小時
- [ ] 效能測試 & 驗證 - 3 小時

### Week 3 (2026-02-19)
- [ ] 文檔更新 & 團隊培訓 - 2 小時

**總工時**: 18 小時
**預期完成**: 2026-02-19

---

## 📊 關鍵數據速查 (Key Metrics)

### 成本對照 (24 個月 TCO)

| 方案 | 直接成本 | TCO 總計 | vs Supabase |
|------|---------|---------|------------|
| **Supabase** ✅ | $452 | $502 | - |
| Cloudinary | $1,210 | $9,610 | +1,814% ❌ |
| 混合架構 | $2,707 | $14,507 | +2,790% ❌ |
| 自建 MinIO | $4,800 | $24,400 | +4,761% ❌ |

### 效能對照

| 指標 | Supabase | Cloudinary | 差距 |
|------|---------|-----------|------|
| 圖片載入時間 (首次) | ~1.2s | ~0.8s | -33% |
| CDN 快取命中率 | 95%+ | 98%+ | -3% |
| 台灣延遲 (TTF) | 50-80ms | 40-60ms | -20ms |

**結論**: Cloudinary 效能略優，但差距不足以支撐遷移成本

---

## 🔄 版本歷史 (Change Log)

| 日期 | 版本 | 變更內容 | 作者 |
|------|------|---------|------|
| 2026-01-29 | 1.0 | 初版，完成架構決策與 4 份文檔 | Leo |
| 2026-07-29 | - | (預定) 6 個月重新評估 | - |

---

## 👥 相關人員 (Stakeholders)

| 角色 | 姓名 | 職責 |
|------|------|------|
| **架構師** | Leo | 架構決策、技術評估 |
| **前端負責人** | TBD | 實施圖片壓縮優化 |
| **後端負責人** | TBD | CDN 快取設定、監控 |
| **專案經理** | TBD | 時程管理、資源協調 |
| **財務** | TBD | 成本審核、預算規劃 |

---

## 🔗 外部資源 (External Resources)

### 官方文檔
- [Supabase Storage](https://supabase.com/docs/guides/storage)
- [Supabase Pricing](https://supabase.com/pricing)
- [Cloudinary Pricing](https://cloudinary.com/pricing)
- [Sharp.js (圖片壓縮)](https://sharp.pixelplumbing.com/)

### 架構模式
- [12-Factor App](https://12factor.net/)
- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)
- [YAGNI Principle](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it)

---

## 💡 常見問題 (FAQ)

### Q1: 為什麼不直接用 Cloudinary?
**A**:
- 過早優化，增加不必要複雜度
- 當前效能已足夠 (P95 < 1.5s)
- 24 個月 TCO 高出 18 倍 ($9,610 vs $502)
- Supabase 整合更好 (統一認證、RLS)

### Q2: 如果以後用戶變多怎麼辦?
**A**:
- Supabase Pro ($25/月) 可支撐至 250GB 頻寬
- 預測 24 個月後僅需 240GB，仍在限制內
- 若真超標，屆時再遷移不遲 (S3 相容 API)

### Q3: Cloudinary 的 AI 功能不需要嗎?
**A**:
- 標案助手系統非圖片密集型應用
- 背景移除、智慧裁切使用率極低
- 若真需要，可按需使用 Azure Vision API (不綁定 Cloudinary)

### Q4: 實施優化需要多久?
**A**:
- 總工時: 18 小時 (約 2-3 週)
- Week 1: 圖片壓縮 + CDN 快取 (9 小時)
- Week 2: 監控介面 + 測試 (7 小時)
- Week 3: 文檔 + 培訓 (2 小時)

### Q5: 如何追蹤效果?
**A**:
- Supabase Dashboard: 儲存/頻寬用量
- Sentry: 圖片載入時間 (Web Vitals)
- 自建監控介面: 用量趨勢與告警

---

## 📞 聯絡方式 (Contact)

**架構相關問題**:
- Leo (系統架構師)
- Email: [待補充]

**實施相關問題**:
- 前端團隊 Lead
- 後端團隊 Lead

**成本相關問題**:
- 財務部門

---

**最後更新**: 2026-01-29
**下次審閱**: 2026-07-29
**文檔狀態**: ✅ 完整、可執行
