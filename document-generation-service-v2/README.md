# ğŸš€ é«˜ä¿çœŸæ–‡ä»¶ç”Ÿæˆæœå‹™ V2

## ğŸ“Œ æ ¸å¿ƒç‰¹è‰²

âœ… **100% ä¿ç•™åŸå§‹æ¨£å¼** - ä½¿ç”¨ easy-template-x,å®Œç¾ä¿ç•™ Word æ ¼å¼  
âœ… **æ”¯æ´è¤‡é›œæ’ç‰ˆ** - å¤šå±¤è¡¨æ ¼ã€åœ–ç‰‡ã€é é¦–é å°¾  
âœ… **å‹•æ…‹è¡¨æ ¼ç”Ÿæˆ** - è‡ªå‹•å‘ä¸‹æ“´å±•è¡¨æ ¼åˆ—  
âœ… **ä¸­æ–‡å®Œç¾æ”¯æ´** - å¾®è»Ÿæ­£é»‘é«”ã€æ¨™æ¥·é«”  
âœ… **æ•´åˆ Supabase** - ç›´æ¥å¾ Storage è®€å–ç¯„æœ¬  
âœ… **n8n ç·¨æ’** - è‡ªå‹•åŒ–å·¥ä½œæµ  

---

## ğŸ—ï¸ æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Next.js)                              â”‚
â”‚  - ä¸Šå‚³ç¯„æœ¬ (.docx)                               â”‚
â”‚  - å¡«å¯«è¡¨å–®                                       â”‚
â”‚  - ä¸‹è¼‰ç”Ÿæˆæ–‡ä»¶                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n Workflow                                    â”‚
â”‚  1. parse-template (è§£æç¯„æœ¬)                     â”‚
â”‚  2. generate-document (ç”Ÿæˆæ–‡ä»¶)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Template       â”‚  â”‚ Document Generation V2      â”‚
â”‚ Parsing        â”‚  â”‚ (easy-template-x)           â”‚
â”‚ (Python)       â”‚  â”‚ (Node.js)                   â”‚
â”‚ Port 8004      â”‚  â”‚ Port 8005                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### **æ­¥é©Ÿ 1: å•Ÿå‹•æœå‹™**

```bash
cd document-generation-service-v2
docker-compose up -d --build
```

### **æ­¥é©Ÿ 2: æª¢æŸ¥å¥åº·ç‹€æ…‹**

```bash
curl http://localhost:8005/health
```

**é æœŸè¼¸å‡º**:
```json
{
  "status": "healthy",
  "service": "document-generation-v2",
  "engine": "easy-template-x",
  "version": "2.0.0"
}
```

### **æ­¥é©Ÿ 3: åŒ¯å…¥ n8n å·¥ä½œæµ**

1. é–‹å•Ÿ n8n: `http://localhost:5678`
2. é»æ“Š **Import from File**
3. åŒ¯å…¥ `n8n-workflows/01-parse-template.json`
4. åŒ¯å…¥ `n8n-workflows/02-generate-document.json`
5. è¨­å®š Supabase æ†‘è­‰
6. å•Ÿå‹•å·¥ä½œæµ

---

## ğŸ“ ç¯„æœ¬è£½ä½œ

### **åŸºæœ¬èªæ³•**

#### 1. **è®Šæ•¸**
```
å®¢æˆ¶åç¨±: {customer_name}
å°ˆæ¡ˆç·¨è™Ÿ: {project_id}
```

#### 2. **å‹•æ…‹è¡¨æ ¼**

åœ¨ Word ä¸­å»ºç«‹è¡¨æ ¼:

| é …ç›® | æ•¸é‡ | å–®åƒ¹ | å°è¨ˆ |
|------|------|------|------|
| {#items}{name} | {quantity} | {price} | {total}{/items} |

**JSON æ•¸æ“š**:
```json
{
  "items": [
    { "name": "ç­†é›»", "quantity": 10, "price": 30000, "total": 300000 },
    { "name": "æ»‘é¼ ", "quantity": 20, "price": 500, "total": 10000 }
  ]
}
```

**ç”Ÿæˆçµæœ**: è¡¨æ ¼æœƒè‡ªå‹•æ“´å±•ç‚º 2 åˆ—

#### 3. **æ¢ä»¶åˆ¤æ–·**
```
{#if score >= 60}
æ­å–œé€šé!
{/if}
```

**å®Œæ•´æŒ‡å—**: è«‹åƒè€ƒ `TEMPLATE_GUIDE.md`

---

## ğŸ§ª æ¸¬è©¦

### **æ¸¬è©¦ 1: åŸºæœ¬ç”Ÿæˆ**

```bash
curl -X POST http://localhost:8005/generate \
  -F "template=@test_template.docx" \
  -F 'data={"customer_name":"å°ç©é›»","project_id":"PRJ-001"}' \
  -o output.docx
```

### **æ¸¬è©¦ 2: å¾ Supabase ç”Ÿæˆ**

```bash
curl -X POST http://localhost:8005/generate-from-supabase \
  -H "Content-Type: application/json" \
  -d '{
    "file_path": "raw-files/template.docx",
    "data": {
      "customer_name": "å°ç©é›»",
      "items": [
        {"name": "ç­†é›»", "quantity": 10}
      ]
    }
  }' \
  -o output.docx
```

---

## ğŸ“Š API æ–‡ä»¶

### **POST /generate**

å¾ä¸Šå‚³çš„ç¯„æœ¬ç”Ÿæˆæ–‡ä»¶

**Request** (multipart/form-data):
- `template`: .docx æª”æ¡ˆ
- `data`: JSON å­—ä¸²

**Response**: ç”Ÿæˆçš„ .docx æª”æ¡ˆ

---

### **POST /generate-from-url**

å¾ URL ä¸‹è¼‰ç¯„æœ¬ä¸¦ç”Ÿæˆ

**Request** (JSON):
```json
{
  "template_url": "https://example.com/template.docx",
  "data": { ... }
}
```

---

### **POST /generate-from-supabase**

å¾ Supabase Storage ä¸‹è¼‰ç¯„æœ¬ä¸¦ç”Ÿæˆ

**Request** (JSON):
```json
{
  "file_path": "raw-files/template.docx",
  "data": { ... },
  "supabase_url": "https://xxx.supabase.co" (å¯é¸)
}
```

---

## ğŸ”§ ç’°å¢ƒè®Šæ•¸

```bash
PORT=8005
NODE_ENV=production
SUPABASE_URL=https://xxx.supabase.co
```

---

## ğŸ“¦ Docker éƒ¨ç½²

### **å–®ç¨éƒ¨ç½²**

```bash
docker build -t document-generation-v2 .
docker run -d -p 8005:8005 \
  -e SUPABASE_URL=https://xxx.supabase.co \
  document-generation-v2
```

### **èˆ‡å…¶ä»–æœå‹™ä¸€èµ·éƒ¨ç½²**

ç·¨è¼¯æ ¹ç›®éŒ„çš„ `docker-compose.yml`,åŠ å…¥:

```yaml
document-generation-v2:
  build: ./document-generation-service-v2
  ports:
    - "8005:8005"
  environment:
    - SUPABASE_URL=${SUPABASE_URL}
```

---

## ğŸ¯ èˆ‡èˆŠç‰ˆçš„å·®ç•°

| åŠŸèƒ½ | V1 (docxtpl) | V2 (easy-template-x) |
|------|--------------|----------------------|
| æ¨£å¼ä¿ç•™ | âš ï¸ æœ‰é™ | âœ… 100% |
| è¤‡é›œè¡¨æ ¼ | âš ï¸ å›°é›£ | âœ… å®Œç¾æ”¯æ´ |
| åœ–ç‰‡è™•ç† | âš ï¸ è¤‡é›œ | âœ… åŸç”Ÿæ”¯æ´ |
| å¤šå±¤è¡¨æ ¼ | âŒ ä¸æ”¯æ´ | âœ… æ”¯æ´ |
| èªè¨€ | Python | Node.js |
| æ•ˆèƒ½ | å¿« | ä¸­ç­‰ |

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [ç¯„æœ¬è£½ä½œæŒ‡å—](./TEMPLATE_GUIDE.md)
- [n8n å·¥ä½œæµ](./n8n-workflows/)
- [API æ¸¬è©¦](./test.js)

---

## ğŸ› æ•…éšœæ’é™¤

### **å•é¡Œ 1: ç¯„æœ¬æ¨™ç±¤æ²’æœ‰è¢«æ›¿æ›**

**åŸå› **: æ¨™ç±¤æ ¼å¼éŒ¯èª¤

**è§£æ±º**: ç¢ºä¿æ¨™ç±¤æ˜¯ `{name}` è€Œä¸æ˜¯ `{ name }` (æ²’æœ‰ç©ºæ ¼)

### **å•é¡Œ 2: è¡¨æ ¼æ²’æœ‰æ“´å±•**

**åŸå› **: `{#items}` å’Œ `{/items}` ä¸åœ¨åŒä¸€åˆ—

**è§£æ±º**: ç¢ºä¿å¾ªç’°æ¨™ç±¤åœ¨è¡¨æ ¼çš„åŒä¸€åˆ—

### **å•é¡Œ 3: ä¸­æ–‡äº‚ç¢¼**

**åŸå› **: Docker ç¼ºå°‘ä¸­æ–‡å­—é«”

**è§£æ±º**: Dockerfile å·²åŒ…å« `font-noto-cjk`,é‡æ–° build

---

**ğŸ‰ é–‹å§‹ä½¿ç”¨é«˜ä¿çœŸæ–‡ä»¶ç”Ÿæˆ!**

