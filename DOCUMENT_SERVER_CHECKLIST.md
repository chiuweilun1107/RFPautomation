# Document Server 部署與維護檢查清單

## 初始部署檢查清單

### 前置需求
- [ ] Docker 和 Docker Compose 已安裝
- [ ] 伺服器有足夠的資源（最低 4GB RAM, 2 CPU cores）
- [ ] 端口 8080 和 8443 可用
- [ ] 網路連接正常

### 安裝配置
- [ ] Docker Compose 配置文件已創建 (`/opt/onlyoffice/docker-compose.yml`)
- [ ] 環境變數已正確設置（JWT、網路、存儲）
- [ ] Docker 卷已創建（data, log, fonts, cache）
- [ ] 文檔目錄權限正確設置

### 啟動驗證
- [ ] 容器成功啟動 (`docker ps | grep onlyoffice`)
- [ ] 健康檢查通過 (`curl http://localhost:8080/healthcheck`)
- [ ] 關鍵服務運行（docservice, converter）
- [ ] 無錯誤日誌（permission, JWT, network）

---

## 日常維護檢查清單（每日）

### 服務狀態
- [ ] 容器運行正常
- [ ] 健康檢查端點可用
- [ ] 核心服務（docservice, converter）運行中
- [ ] API 響應正常

### 資源監控
- [ ] CPU 使用率 < 80%
- [ ] 記憶體使用率 < 80%
- [ ] 磁碟空間 > 20% 可用
- [ ] 網路連接穩定

### 日誌檢查
- [ ] 無權限錯誤（EACCES, permission denied）
- [ ] 無 JWT 認證錯誤
- [ ] 無連接超時錯誤
- [ ] 無資料庫錯誤

---

## 週期性維護檢查清單（每週）

### 性能優化
- [ ] 清理舊日誌文件（保留 7-30 天）
- [ ] 檢查並清理未使用的 Docker 資源
- [ ] 檢查快取目錄大小
- [ ] 檢查文檔存儲使用情況

### 安全審查
- [ ] 檢查存取日誌中的異常模式
- [ ] 驗證 JWT 配置仍然正確
- [ ] 檢查防火牆規則
- [ ] 審查最近的認證失敗

### 備份驗證
- [ ] 自動備份正常執行
- [ ] 備份文件完整性驗證
- [ ] 備份存儲空間足夠
- [ ] 測試備份恢復流程（每月一次）

---

## 月度維護檢查清單

### 更新與升級
- [ ] 檢查是否有新版本可用
- [ ] 審查更新日誌（changelog）
- [ ] 在測試環境驗證新版本
- [ ] 規劃生產環境升級窗口
- [ ] 執行升級前完整備份
- [ ] 執行升級並驗證

### 容量規劃
- [ ] 評估資源使用趨勢
- [ ] 預測未來 3 個月的需求
- [ ] 規劃擴容策略（如需要）
- [ ] 檢查存儲擴展需求

### 災難恢復測試
- [ ] 測試備份恢復流程
- [ ] 驗證 RTO（恢復時間目標）
- [ ] 驗證 RPO（恢復點目標）
- [ ] 更新災難恢復文檔

---

## 問題排查檢查清單

### 當服務無法存取時
1. [ ] 檢查容器是否運行 (`docker ps`)
2. [ ] 檢查服務狀態 (`supervisorctl status`)
3. [ ] 檢查端口綁定 (`netstat -tlnp`)
4. [ ] 檢查防火牆規則
5. [ ] 檢查健康檢查端點
6. [ ] 查看容器日誌
7. [ ] 檢查資源限制（CPU, Memory）

### 當出現權限錯誤時
1. [ ] 檢查快取目錄存在性
2. [ ] 驗證目錄所有權（應為 ds:ds）
3. [ ] 驗證目錄權限（應為 775）
4. [ ] 檢查 Data 目錄權限
5. [ ] 執行權限修復腳本
6. [ ] 重啟服務驗證

### 當出現認證錯誤時
1. [ ] 檢查 JWT_ENABLED 設置
2. [ ] 驗證 JWT_SECRET 配置
3. [ ] 檢查 local.json 配置
4. [ ] 驗證客戶端 JWT token
5. [ ] 檢查認證頭格式
6. [ ] 查看認證相關日誌

### 當性能降低時
1. [ ] 檢查 CPU 和記憶體使用
2. [ ] 檢查磁碟 I/O
3. [ ] 檢查網路延遲
4. [ ] 查看活躍連接數
5. [ ] 檢查資料庫性能
6. [ ] 分析慢查詢日誌
7. [ ] 考慮擴展資源

---

## 安全加固檢查清單

### JWT 配置
- [ ] JWT 在生產環境中已啟用
- [ ] JWT secret 使用強隨機密鑰（32+ 字符）
- [ ] JWT secret 安全存儲（不在代碼庫中）
- [ ] JWT token 有適當的過期時間
- [ ] 所有客戶端應用正確使用 JWT

### 網路安全
- [ ] 防火牆規則限制存取來源
- [ ] HTTPS 已配置（生產環境）
- [ ] SSL/TLS 證書有效且未過期
- [ ] 禁用不必要的服務和端口
- [ ] 網路分段和隔離

### 存取控制
- [ ] 最小權限原則應用於所有服務
- [ ] SSH 密鑰認證（禁用密碼登入）
- [ ] Docker 容器以非 root 用戶運行（where possible）
- [ ] 定期審查和更新存取權限
- [ ] 啟用審計日誌

### 資料保護
- [ ] 敏感資料加密存儲
- [ ] 傳輸層使用 TLS/SSL
- [ ] 定期資料備份
- [ ] 備份加密存儲
- [ ] 備份異地存放

---

## 監控與告警檢查清單

### 監控指標
- [ ] 服務可用性監控
- [ ] 響應時間監控
- [ ] 錯誤率監控
- [ ] 資源使用監控（CPU, Memory, Disk）
- [ ] API 請求量監控
- [ ] 並發用戶數監控

### 告警配置
- [ ] 服務宕機告警
- [ ] 高錯誤率告警
- [ ] 資源超限告警（>80%）
- [ ] 磁碟空間不足告警（<20%）
- [ ] 異常流量告警
- [ ] 安全事件告警

### 告警響應
- [ ] 告警通知渠道配置（Email, Slack, etc）
- [ ] 告警級別定義（Critical, Warning, Info）
- [ ] 告警響應流程文檔化
- [ ] 值班輪換表建立
- [ ] 告警處理記錄維護

---

## 文檔檢查清單

### 必要文檔
- [ ] 系統架構圖
- [ ] 部署流程文檔
- [ ] 配置參考文檔
- [ ] 故障排查指南
- [ ] 災難恢復計劃
- [ ] 變更管理流程

### 文檔維護
- [ ] 定期審查和更新文檔
- [ ] 版本控制所有文檔
- [ ] 文檔存取權限管理
- [ ] 知識庫建立和維護
- [ ] 培訓材料準備

---

## 合規性檢查清單

### GDPR / 資料保護
- [ ] 個人資料識別和分類
- [ ] 資料處理協議簽署
- [ ] 資料保留政策實施
- [ ] 資料刪除流程建立
- [ ] 用戶同意機制

### 審計與記錄
- [ ] 啟用完整的審計日誌
- [ ] 日誌保留期符合要求
- [ ] 敏感操作記錄
- [ ] 定期審計報告
- [ ] 合規性文檔維護

---

## 緊急響應檢查清單

### 準備階段
- [ ] 緊急聯絡人清單
- [ ] 備份恢復流程測試
- [ ] 回滾計劃準備
- [ ] 應急響應團隊組建
- [ ] 溝通計劃準備

### 事件響應
- [ ] 識別和記錄事件
- [ ] 評估影響和嚴重性
- [ ] 啟動應急響應流程
- [ ] 通知相關利益方
- [ ] 執行修復措施
- [ ] 驗證恢復狀態
- [ ] 事後分析和改進

---

## 使用此檢查清單

### 建議頻率
- **每日**: 服務狀態、資源監控、日誌檢查
- **每週**: 性能優化、安全審查、備份驗證
- **每月**: 更新升級、容量規劃、災難恢復測試
- **每季**: 全面安全審計、合規性審查
- **每年**: 架構審查、災難恢復演練

### 自動化
優先自動化以下檢查項目：
- 健康檢查和監控
- 日誌分析和告警
- 備份執行和驗證
- 資源使用報告
- 安全掃描

### 記錄保存
- 維護檢查清單完成記錄
- 記錄發現的問題和解決方案
- 追蹤改進措施的實施
- 定期審查和更新檢查清單

---

**上次更新**: 2026-01-24
**版本**: 1.0
**維護者**: DevOps Team
