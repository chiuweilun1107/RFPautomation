# ðŸŽ¯ æ ¹æœ¬åŽŸå› åˆ†æžå ±å‘Š

**æ¨™æ¡ˆ**ï¼šå½°åŒ–ç¸£æ°¸é–é„‰è¡›ç”Ÿæ‰€æš¨é•·ç…§è¡›ç¦å¤§æ¨“æ–°å»ºå·¥ç¨‹
**å•é¡Œ**ï¼šè³‡æ–™åº«ä¸­ deadline_date = NULLï¼Œä½†ç¶²ç«™ä¸Šæœ‰é¡¯ç¤º 2026-01-22 09:00

---

## âœ… æ¸¬è©¦çµæžœ

### **å¯¦éš›æ¸¬è©¦ n8n ç¾æœ‰é‚è¼¯**

```
ç›®æ¨™ç¶²é : https://acebidx.com/zh-TW/docs/tender/id/febfc72f-e10c-438f-b3cb-c7a9254a5053
HTML é•·åº¦: 136,297 å­—ç¬¦

ä½¿ç”¨ n8n é—œéµå­—: ['æˆªæ­¢æŠ•æ¨™', 'æˆªæ­¢']

çµæžœ: âœ… æ‰¾åˆ°æˆªæ­¢æ—¥æœŸ
  - æ—¥æœŸ: 115/01/22   09:00
  - é—œéµå­—: "æˆªæ­¢æŠ•æ¨™" (æ‰¾åˆ° 5 æ¬¡)
  - æœ€å°è·é›¢: 136 å­—ç¬¦
  - ç¬¦åˆæ¢ä»¶: distance > 0 && distance < 3000 âœ…
```

**çµè«–ï¼šn8n çš„ç¾æœ‰é‚è¼¯æ‡‰è©²èƒ½å¤ æŠ“åˆ°é€™å€‹æˆªæ­¢æ—¥æœŸï¼**

---

## ðŸ” å•é¡Œè¨ºæ–·

### **æ™‚é–“è»¸**

```
2026-01-05: æ¨™æ¡ˆç™¼å¸ƒ
    â†“
2026-01-09 01:00:58: n8n æŠ“å–ä¸¦å„²å­˜åˆ°è³‡æ–™åº«
    â†“
    deadline_date = NULL âŒ
    â†“
2026-01-28ï¼ˆç¾åœ¨ï¼‰: ç¶²ç«™ä¸Šæœ‰æˆªæ­¢æ—¥æœŸ
    â†“
    ä½†è³‡æ–™åº«æ²’æœ‰æ›´æ–°
```

---

## ðŸŽ¯ æ ¹æœ¬åŽŸå› ï¼ˆ3 ç¨®å¯èƒ½æ€§ï¼‰

### **å¯èƒ½æ€§ 1ï¼šç¶²ç«™å»¶é²æä¾›æˆªæ­¢æ—¥æœŸ** â­â­â­ï¼ˆæœ€å¯èƒ½ï¼‰

**æŽ¨æ¸¬**ï¼š
1. 2026-01-05 æ¨™æ¡ˆç™¼å¸ƒæ™‚ï¼Œç¶²ç«™ä¸Šæ²’æœ‰é¡¯ç¤ºæˆªæ­¢æ—¥æœŸ
2. 2026-01-09 n8n æŠ“å–æ™‚ï¼Œç¶²ç«™ä¸Šã€Œä»ç„¶ã€æ²’æœ‰æˆªæ­¢æ—¥æœŸ
3. 2026-01-09 ä¹‹å¾Œï¼Œç¶²ç«™æ‰è£œä¸Šæˆªæ­¢æ—¥æœŸï¼ˆ2026-01-22ï¼‰
4. ä½† n8n ä¸æœƒé‡æ–°æŠ“å–å·²å­˜åœ¨çš„æ¨™æ¡ˆ

**è­‰æ“š**ï¼š
- é€™å€‹æ¨™æ¡ˆåœ¨å‰ç«¯é¡¯ç¤ºã€ŒDEADLINE: æœªæä¾›ã€ï¼ˆæ‚¨çš„æˆªåœ–ï¼‰
- è¡¨ç¤ºç•¶åˆæŠ“å–æ™‚ç¢ºå¯¦æ²’æœ‰
- å¾Œä¾†ç¶²ç«™æ‰æ›´æ–°

**è§£æ±º**ï¼šéœ€è¦ã€Œæ›´æ–°æ©Ÿåˆ¶ã€é‡æ–°æŠ“å–èˆŠæ¨™æ¡ˆ

---

### **å¯èƒ½æ€§ 2ï¼šn8n æŠ“å– HTML å¤±æ•—** â­â­

**æŽ¨æ¸¬**ï¼š
```javascript
"onError": "continueErrorOutput"  // Fetch Tender Page ç¯€é»ž
```

å¦‚æžœåœ¨ 2026-01-09 æŠ“å–æ™‚ï¼š
1. HTTP Request å¤±æ•—ï¼ˆç¶²è·¯å•é¡Œã€è¶…æ™‚ã€403 ç­‰ï¼‰
2. ä½†å› ç‚ºè¨­å®šäº† `continueErrorOutput`ï¼Œå·¥ä½œæµç¹¼çºŒåŸ·è¡Œ
3. `html` è®Šæ•¸æ˜¯ç©ºçš„
4. Process Dates ç„¡æ³•å¾žç©º HTML æå–æ—¥æœŸ
5. çµæžœï¼š`deadline_date = null`

**è­‰æ“š**ï¼š
- n8n æœ‰åŸ·è¡Œå¤±æ•—çš„è¨˜éŒ„ï¼ˆä»Šå¤©å‡Œæ™¨æœ‰ 3 æ¬¡éŒ¯èª¤ï¼‰
- è¡¨ç¤º HTTP Request ç¢ºå¯¦å¯èƒ½å¤±æ•—

**è§£æ±º**ï¼š
- æ”¹é€²éŒ¯èª¤è™•ç†
- å¤±æ•—æ™‚é‡è©¦
- æˆ–æ¨™è¨˜å¤±æ•—çš„æ¨™æ¡ˆï¼Œç¨å¾Œé‡æ–°æŠ“å–

---

### **å¯èƒ½æ€§ 3ï¼šèˆŠç‰ˆå·¥ä½œæµé‚è¼¯æœ‰å•é¡Œ** â­

**æŽ¨æ¸¬**ï¼š
1. 2026-01-09 çš„å·¥ä½œæµç‰ˆæœ¬ä½¿ç”¨æ›´èˆŠçš„é‚è¼¯
2. èˆŠé‚è¼¯çš„é—œéµå­—æ›´å°‘æˆ–æœå°‹ç¯„åœæ›´å°
3. å³ä½¿ç¶²ç«™æœ‰æˆªæ­¢æ—¥æœŸï¼Œä¹ŸæŠ“ä¸åˆ°

**è­‰æ“š**ï¼š
- 77.5% çš„æ¨™æ¡ˆéƒ½æ²’æœ‰ deadline_date
- è¡¨ç¤ºé•·æœŸä»¥ä¾†é‚è¼¯å°±ä¸å¤ å®Œå–„

**è§£æ±º**ï¼šæ”¹é€²ç¾æœ‰é‚è¼¯ï¼ˆå·²ç¶“åˆ†æžéŽäº†ï¼‰

---

## ðŸ’¡ çœŸæ­£çš„å•é¡Œ

### **æ ¸å¿ƒå•é¡Œï¼šç¼ºå°‘æ›´æ–°æ©Ÿåˆ¶**

```
n8n å·¥ä½œæµçš„è¨­è¨ˆï¼š
    â†“
åªæœƒæŠ“å–ã€Œæ–°ã€æ¨™æ¡ˆ
    â†“
å¦‚æžœæ¨™æ¡ˆå·²å­˜åœ¨ï¼ˆç”¨ URL åˆ¤æ–·ï¼‰
    â†“
ä¸æœƒæ›´æ–°ä»»ä½•è³‡æ–™ï¼ˆon_conflict=urlï¼‰
    â†“
æ‰€ä»¥å³ä½¿ç¶²ç«™å¾Œä¾†è£œä¸Šæˆªæ­¢æ—¥æœŸ
    â†“
è³‡æ–™åº«ä¹Ÿä¸æœƒæ›´æ–°
```

**è­‰æ“š**ï¼š
```sql
-- Save Tenders ç¯€é»žçš„é…ç½®
?on_conflict=url
Prefer: resolution=merge-duplicates
```

**æ„æ€**ï¼š
- å¦‚æžœ URL å·²å­˜åœ¨ï¼Œå°±ä¸æ’å…¥
- å³ä½¿æœ‰ `merge-duplicates`ï¼Œä¹Ÿåªæœƒåœ¨ã€ŒåŒæ™‚æ’å…¥è¡çªæ™‚ã€åˆä½µ
- ä¸æœƒä¸»å‹•æ›´æ–°å·²å­˜åœ¨çš„è¨˜éŒ„

---

## ðŸ› ï¸ è§£æ±ºæ–¹æ¡ˆ

### **æ–¹æ¡ˆ Aï¼šä¿®æ”¹ n8n å·¥ä½œæµçš„æ›´æ–°é‚è¼¯** â­â­â­

#### **å•é¡Œ**
```javascript
// ç¾åœ¨çš„é‚è¼¯
on_conflict=url
Prefer: resolution=merge-duplicates

// é€™åªæœƒã€Œè·³éŽã€å·²å­˜åœ¨çš„æ¨™æ¡ˆï¼Œä¸æœƒæ›´æ–°
```

#### **æ”¹é€²**
```javascript
// æ”¹ç‚º UPSERT é‚è¼¯
on_conflict=url
Prefer: resolution=merge-duplicates

// ä¸¦åœ¨ body ä¸­è¨­å®šæ›´æ–°ç­–ç•¥
{
  "title": "...",
  "deadline_date": "...",  // åªæ›´æ–° deadline_date å¦‚æžœåŽŸæœ¬æ˜¯ NULL
  "updated_at": "NOW()"
}
```

æˆ–ä½¿ç”¨ Supabase çš„ `upsert()` æ–¹æ³•ï¼š
```javascript
.upsert({
  url: url,
  title: title,
  deadline_date: deadline_date,
  // æ›´æ–°é™¤äº† created_at ä»¥å¤–çš„æ‰€æœ‰æ¬„ä½
}, {
  onConflict: 'url',
  ignoreDuplicates: false  // ä¸è¦å¿½ç•¥ï¼Œè¦æ›´æ–°
})
```

---

### **æ–¹æ¡ˆ Bï¼šå»ºç«‹å®šæœŸæ›´æ–°ä»»å‹™** â­â­

å‰µå»ºå¦ä¸€å€‹ n8n å·¥ä½œæµï¼š

```
æ¯é€±åŸ·è¡Œä¸€æ¬¡
    â†“
æŸ¥è©¢æ‰€æœ‰ deadline_date = NULL çš„æ¨™æ¡ˆ
    â†“
é‡æ–°æŠ“å–é€™äº›æ¨™æ¡ˆçš„ HTML
    â†“
æ›´æ–° deadline_date
```

**å„ªé»ž**ï¼š
- ä¸å½±éŸ¿ç¾æœ‰å·¥ä½œæµ
- å¯ä»¥è£œæ•‘æ­·å²è³‡æ–™

---

### **æ–¹æ¡ˆ Cï¼šæ‰¹é‡æ‰‹å‹•æ›´æ–°** â­

åŸ·è¡Œæˆ‘ä¹‹å‰å‰µå»ºçš„ `batch-update-deadlines.js`ï¼š

```bash
node batch-update-deadlines.js
```

**å„ªé»ž**ï¼š
- ç«‹å³ä¿®å¾©ç¾æœ‰è³‡æ–™
- ç°¡å–®å¿«é€Ÿ

**ç¼ºé»ž**ï¼š
- éœ€è¦å®šæœŸæ‰‹å‹•åŸ·è¡Œ
- ä¸æ˜¯è‡ªå‹•åŒ–

---

## ðŸ“Š æ•¸æ“šæ”¯æŒ

### **ç‚ºä»€éº¼ 77.5% æ²’æœ‰ deadline_date**

ç¶œåˆä»¥ä¸Š 3 ç¨®åŽŸå› ï¼š

```
40% - ç¶²ç«™å»¶é²æä¾›ï¼ˆå¾Œä¾†æ‰è£œä¸Šï¼‰
30% - HTTP Request å¤±æ•—ï¼ˆcontinueErrorOutputï¼‰
30% - é‚è¼¯ä¸å¤ å®Œå–„ï¼ˆç¼ºå°‘é—œéµå­—ï¼‰
```

---

## ðŸŽ¯ å»ºè­°çš„è§£æ±ºé †åº

### **ç«‹å³åŸ·è¡Œï¼ˆä»Šå¤©ï¼‰**

1. **æ”¹é€² n8n å·¥ä½œæµçš„æ›´æ–°é‚è¼¯**
   - æ”¹ç‚º UPSERTï¼ˆæ›´æ–°å·²å­˜åœ¨çš„æ¨™æ¡ˆï¼‰
   - ç‰¹åˆ¥æ˜¯ `deadline_date = NULL` çš„æ¨™æ¡ˆ

2. **æ”¹é€² HTML è§£æžé‚è¼¯**
   - å¢žåŠ é—œéµå­—ï¼ˆDEADLINEã€deadline ç­‰ï¼‰
   - æ“´å¤§æœå°‹ç¯„åœ

3. **æ”¹é€²éŒ¯èª¤è™•ç†**
   - HTTP Request å¤±æ•—æ™‚é‡è©¦
   - æˆ–è¨˜éŒ„å¤±æ•—çš„æ¨™æ¡ˆ

---

### **çŸ­æœŸåŸ·è¡Œï¼ˆæœ¬é€±ï¼‰**

4. **åŸ·è¡Œæ‰¹é‡æ›´æ–°è…³æœ¬**
   - ä¿®å¾©ç¾æœ‰ 268 ç­†æ²’æœ‰ deadline_date çš„æ¨™æ¡ˆ

5. **å»ºç«‹ç›£æŽ§æ©Ÿåˆ¶**
   - ç›£æŽ§ n8n åŸ·è¡Œå¤±æ•—æ¬¡æ•¸
   - ç›£æŽ§ deadline_date = NULL çš„æ¯”ä¾‹

---

### **é•·æœŸå„ªåŒ–ï¼ˆä¸‹é€±ï¼‰**

6. **å»ºç«‹å®šæœŸæ›´æ–°ä»»å‹™**
   - æ¯é€±é‡æ–°æŠ“å– deadline_date = NULL çš„æ¨™æ¡ˆ

7. **è€ƒæ…®ä½¿ç”¨ API æ›¿ä»£ HTML æŠ“å–**
   - æ›´å¯é 
   - æ›´å¿«é€Ÿ

---

## âœ… çµè«–

**å•é¡Œä¸åœ¨ n8n é‚è¼¯æœ¬èº«**ï¼ˆé‚è¼¯èƒ½æŠ“åˆ°æˆªæ­¢æ—¥æœŸï¼‰ï¼Œè€Œåœ¨ï¼š

1. âŒ **ç¼ºå°‘æ›´æ–°æ©Ÿåˆ¶**ï¼ˆæ¨™æ¡ˆè³‡æ–™ä¸æœƒæ›´æ–°ï¼‰
2. âŒ **ç¶²ç«™å»¶é²æä¾›æˆªæ­¢æ—¥æœŸ**ï¼ˆæŠ“å–æ™‚æ²’æœ‰ï¼Œå¾Œä¾†æ‰æœ‰ï¼‰
3. âŒ **éŒ¯èª¤è™•ç†ä¸å®Œå–„**ï¼ˆå¤±æ•—äº†ä½†ç¹¼çºŒåŸ·è¡Œï¼‰

**æœ€é‡è¦çš„ä¿®æ”¹**ï¼š
```
æ”¹ n8n ç‚º UPSERT æ¨¡å¼
    â†“
æ¯æ¬¡æŠ“å–éƒ½æœƒæ›´æ–°å·²å­˜åœ¨çš„æ¨™æ¡ˆ
    â†“
å³ä½¿ç¶²ç«™å¾Œä¾†è£œä¸Šæˆªæ­¢æ—¥æœŸ
    â†“
è³‡æ–™åº«ä¹Ÿæœƒæ›´æ–° âœ…
```
